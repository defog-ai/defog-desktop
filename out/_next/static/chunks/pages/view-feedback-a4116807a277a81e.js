(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{86244:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/view-feedback",function(){return n(98274)}])},9857:function(e,t,n){"use strict";var a=n(28598),s=n(82684),o=n(80128),r=n(46835);let i=e=>{let{helperText:t,mainText:n,onUpdate:i,isEditable:l,inputModeOn:d=!1}=e,[c,u]=(0,s.useState)(n),[h,m]=(0,s.useState)(d),g=()=>{i(c),m(!1)},y=()=>m(!h);return(0,a.jsxs)("div",{style:{backgroundColor:"#FFFAF0",borderLeft:"5px solid #FFA500",padding:"10px",margin:"10px 0",fontFamily:"Monospace",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:[t,"\xa0"]}),h?(0,a.jsx)(o.Z,{value:c,onChange:e=>u(e.target.value),onPressEnter:g,onBlur:g,autoFocus:!0,style:{flex:1}}):(0,a.jsx)("span",{style:{flex:1},children:c}),l&&(0,a.jsx)(r.Z,{onClick:y,style:{cursor:"pointer",color:"#FFA500",marginLeft:"10px"}})]})};t.Z=i},42449:function(e,t,n){"use strict";var a=n(28598),s=n(1887),o=n.n(s);let r=()=>(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]});t.Z=r},22500:function(e,t,n){"use strict";var a=n(28598),s=n(82684),o=n(36189),r=n(79869),i=n(34376);n(12691);var l=n(26978),d=n(47663),c=n(56572);let u=e=>{let{id:t,userType:n,children:u,rootClassNames:h="",contentClassNames:m=""}=e,{Content:g,Sider:y}=r.Ar,[p,f]=(0,s.useState)([]),[x,j]=(0,s.useContext)(o.S),k=(0,i.useRouter)(),b=e=>{k.push(e)},w=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),j({user:null,token:null,userType:null}),b("/log-in")},v=(0,d.usePathname)();(0,s.useEffect)(()=>{f(("admin"==n?[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"manage-tools",title:"Manage tools",href:"/manage-tools"},{key:"check-readiness",title:"Check Readiness",href:"/check-readiness"},{key:"align-model",title:"Align Model",href:"/align-model"},{key:"view-feedback",title:"View Feedback",href:"/view-feedback"},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:w}]:n?[{key:"view-notebooks",title:"View your notebook",href:"/view-notebooks"},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:w}]:[]).map(e=>(e.current=e.href==v,e)))},[n]);let[S,C]=(0,s.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,s.useEffect)(()=>{"/query-data"===v&&C("flex flex-col md:min-h-screen relative")},[v]),(0,a.jsxs)("div",{className:(0,c.m6)(S,h),children:[p.length?(0,a.jsx)(l.l2,{rootClassNames:"border-b",items:p}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:(0,c.m6)("grow",m),children:u})]})};t.Z=u},98274:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var a=n(28598),s=n(82684),o=n(42449),r=n(22500),i=n(93146),l=n(84672),d=n(30652),c=n(56193),u=n(80128),h=n(16496),m=n(4134),g=n(42339),y=n(21013);let p=e=>{let{token:t,apiKeyName:n,feedbackColumns:o,feedback:r,filter:l,goldenQueries:d,setGoldenQueries:c,handleNegativeFeedback:u}=e,[p,f]=(0,s.useState)({}),[x,j]=(0,s.useState)(!1),[k,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{w()},[d,k,r]);let w=async()=>{let e={};r.forEach(t=>{let n="".concat(t[2],"_").concat(F(t[3])),a=(d||[]).some(e=>e.question===t[2]&&F(e.sql)===F(t[3]));e[n]=a}),f(e)},v=async(e,a)=>{let s=await S(e,a);if(s)return;(d||[]).push({question:e,sql:a});let o=await fetch((0,i.Z)("http","integration/update_golden_queries"),{method:"POST",body:JSON.stringify({token:t,key_name:n,golden_queries:d}),headers:{"Content-Type":"application/json"}}),r=await o.json();return c(d),r},S=async(e,t)=>{let n=(d||[]).some(n=>{let a=F(n.sql),s=F(t),o=n.question.trim()===e.trim();return o&&a===s});return n},C=async(e,t)=>{j(!0);try{let n=await v(e,t);"success"==n.status&&h.ZP.success("Added to Golden Queries successfully!"),await w()}catch(a){console.error("Failed to add to golden queries:",a),h.ZP.error("Failed to add to Golden Queries.")}finally{j(!1),b(!k)}},F=e=>e.replace(/\s+/g," ").trim(),_=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,Z=o.map((e,t)=>"created_at"==e?{title:"Timestamp",dataIndex:e,key:e,render:e=>(0,a.jsx)("div",{style:{color:"grey"},children:new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),width:"7%",align:"center"}:"feedback_type"===e?{title:"Type",dataIndex:e,key:e,render:e=>(0,a.jsx)(m.ZP,{type:"primary",shape:"round",size:"small",style:{backgroundColor:"bad"===e.toLowerCase()?"#f5222d":"#52c41a",borderColor:"bad"===e.toLowerCase()?"#f5222d":"#52c41a",color:"#fff"},children:_(e)}),width:"5%",align:"center"}:"query_generated"===e?{title:(0,a.jsx)("div",{style:{textAlign:"center"},children:"Generated SQL Query"}),dataIndex:e,key:e,render:e=>(0,a.jsx)("pre",{style:{whiteSpace:"pre-wrap",backgroundColor:"#f4f4f4",maxHeight:"300px",overflow:"auto"},children:e}),width:"40%"}:"feedback_text"===e?{title:"Feedback Text",dataIndex:e,key:e,render:e=>(0,a.jsx)("div",{style:{color:"#FF8C00",fontFamily:"Courier, monospace",fontSize:"1.1em",maxHeight:"300px",overflow:"auto"},children:e}),width:"20%",align:"center"}:"question"===e?{title:"Question",dataIndex:e,key:e,render:(e,t)=>(0,a.jsxs)("div",{style:{maxHeight:"300px",overflow:"auto"},children:[e,t.parentQuestionText&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("br",{}),(0,a.jsxs)("span",{style:{color:"grey"},children:["Parent Question Text: ",t.parentQuestionText]})]})]}),width:"20%",align:"center"}:{title:e,dataIndex:e,key:e});Z.push({title:"Recommendation",key:"recommendation",render:(e,t)=>{let n=p["".concat(t.question,"_").concat(F(t.query_generated))];return"bad"===t.feedback_type.toLowerCase()?(0,a.jsx)(m.ZP,{onClick:()=>u(t.question,t.query_generated,t.feedback_text),style:{backgroundColor:"#4CAF50",borderColor:"#4CAF50",color:"#fff",minWidth:"95%"},children:"Improve using Feedback"}):(0,a.jsx)(m.ZP,{onClick:async()=>{try{await C(t.question,t.query_generated)}catch(e){console.error("Failed to add to golden queries:",e)}},disabled:n,style:{backgroundColor:n?"#f0e68c":"#ffd700",borderColor:n?"#f0e68c":"#ffd700",color:"#000",opacity:n?.4:1,minWidth:"95%"},children:n?"Already a Golden Query":"Add to Golden Queries"})},width:"8%",align:"center"});let T=r.filter(e=>{var t,n,a;return(null===(t=e[1])||void 0===t?void 0:t.toLowerCase().includes(null==l?void 0:l.toLowerCase()))||(null===(n=e[2])||void 0===n?void 0:n.toLowerCase().includes(null==l?void 0:l.toLowerCase()))||(null===(a=e[3])||void 0===a?void 0:a.toLowerCase().includes(null==l?void 0:l.toLowerCase()))}),q=T.map((e,t)=>{let n={};return o.forEach((t,a)=>{n[t]=e[a]}),n.key=t,n});return(0,a.jsx)(g.Z,{spinning:x,tip:"Adding to Golden Queries...",children:(0,a.jsx)("div",{className:"w-full h-full p-1 bg-gray-50 shadow rounded-lg",children:(0,a.jsx)(y.Z,{columns:Z,dataSource:q,pagination:!1,scroll:{x:!0},rowKey:"key"})})})};var f=n(34376),x=function(e){let{columns:t,data:n}=e;return(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{children:t.map((e,t)=>(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"8px",backgroundColor:"#eee"},children:e},t))})}),(0,a.jsx)("tbody",{children:n.map((e,t)=>(0,a.jsx)("tr",{children:e.map((e,t)=>(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:e.toString()},t))},t))})]})},j=function(e){let{query:t}=e;return(0,a.jsx)("div",{style:{backgroundColor:"#f4f4f4",padding:"10px",borderRadius:"5px",fontFamily:"monospace"},children:(0,a.jsx)("pre",{children:t})})},k=n(42634),b=n(9857),w=n(2112),v=n(21451),S=n(8301),C=n(15610),F=n(92297),_=n(10106),Z=n(85546);let{TextArea:T}=u.Z,q=e=>{let{isModalVisible:t,setIsModalVisible:n,token:o,apiKeyName:r,question:l,sqlGenerated:d,userFeedback:c,getCurrentGlossary:u}=e,h=(0,f.useRouter)(),[y,p]=(0,s.useState)(l),[q,N]=(0,s.useState)(c),[A,I]=(0,s.useState)(""),[E,L]=(0,s.useState)(""),[P,Q]=(0,s.useState)([]),[O,R]=(0,s.useState)([]),[G,D]=(0,s.useState)(!0),[U,z]=(0,s.useState)(!1),[B,H]=(0,s.useState)(!1);(0,s.useEffect)(()=>{J()},[q]);let M=()=>{I(""),L(""),R([]),Q([]),n(!1)},J=async()=>{D(!0);try{let e=await fetch((0,i.Z)("http","get_instructions_recommendation"),{method:"POST",body:JSON.stringify({token:o,key_name:r,question:y,sql_generated:d,user_feedback:q}),headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error, status = ".concat(e.status));let t=await e.json();if(t.error)throw Error(t.error);I(t.instruction_set||"")}catch(n){console.error("Failed to populate instructions:",n.message),I("Failed to load instructions due to an error.")}finally{D(!1)}},W=async e=>{let t=await fetch((0,i.Z)("http","integration/update_glossary"),{method:"POST",body:JSON.stringify({token:o,key_name:r,glossary:e}),headers:{"Content-Type":"application/json"}}),n=await t.json();return n},V=async()=>{z(!0);let e=await u(),t=e.concat(A),n=await fetch((0,i.Z)("http","query"),{method:"POST",body:JSON.stringify({token:o,key_name:r,question:y,previous_context:[],dev_body:!1,ignore_cache:!0,glossary:t}),headers:{"Content-Type":"application/json"}}),a=await n.json();L(a.query_generated),Q(a.columns),R(a.data),z(!1),console.log(a)},K=async()=>{let e=await u(),t=e.concat("\n"+A);W(t),I(""),H(!0)};return(0,a.jsx)(k.Z,{title:"",open:t,onOk:M,onCancel:M,width:"80vw",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{style:{textAlign:"center",marginTop:"1em",marginBottom:"1em"},children:(0,a.jsxs)("div",{children:[(0,a.jsx)(w.Z,{className:"text-4xl"}),(0,a.jsx)("p",{className:"text-2xl mt-4",children:"Recommendations"})]})}),(0,a.jsx)(b.Z,{helperText:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),"\xa0 Your Feedback:"]}),mainText:c,onUpdate:e=>{N(e)},isEditable:!G}),(0,a.jsx)("p",{style:{paddingLeft:"1.1em"},children:G?"The more meaningful the feedback, the better suggestions you get! You will soon have an option to edit the feedback and doing so automatically regenerates new instructions for you!":"Based on your feedback these are the instructions when given to the model might help get the right answer. Feel free to edit before hitting ask defog again:"}),G?(0,a.jsx)(g.Z,{tip:"Aligning the model based on your feedback. This might take up to 30-60 seconds. We appreciate your patience!",children:(0,a.jsx)(T,{disabled:!0,placeholder:"Generating instructions...",style:{width:"95%",padding:"1em",margin:"1em"}})}):(0,a.jsx)(T,{value:A,onChange:e=>{I(e.target.value)},placeholder:"Instructions Appear Here",style:{width:"95%",padding:"1em",margin:"1em",minHeight:"150px"}})]}),(0,a.jsx)(b.Z,{helperText:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),"\xa0 Question:"]}),mainText:l,onUpdate:e=>p(e),isEditable:!G&&!U}),(0,a.jsx)("div",{children:(0,a.jsxs)(m.ZP,{onClick:V,type:"dashed",style:{minWidth:"23%",padding:"1.2em",paddingBottom:"1.1em",margin:"1em",marginBottom:"0.5em",marginTop:"0.5em",height:"auto"},disabled:""===A||G||U,children:[(0,a.jsx)(C.Z,{style:{fontSize:"20px",marginRight:"8px"}}),U?"Running...":"Ask Defog with Updated Instructions"]})}),!G&&E&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{width:"95%",paddingLeft:"1.1em"},children:[(0,a.jsxs)("h2",{className:"text-xl mt-4 mb-3",style:{textAlign:"left"},children:[" ",(0,a.jsx)(F.Z,{style:{fontSize:"24px",marginRight:"8px"}})," ","Updated Results Using Instructions"]}),(0,a.jsx)("h3",{className:"text-lg mt-2 mb-1 text-left",children:"Generated SQL Query"}),(0,a.jsx)(j,{query:E}),(0,a.jsx)("h3",{className:"text-lg mt-2 mb-1 text-left",children:"Query Results"}),(0,a.jsx)(x,{columns:P,data:(O||[]).map(e=>e.map(e=>e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(b.Z,{helperText:(0,a.jsx)(_.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),mainText:"Did this improve your results? If yes, consider adding those instructions to the glossary permanently to tailor it for the future.",onUpdate:()=>{},isEditable:!1}),(0,a.jsxs)(m.ZP,{onClick:K,type:"dashed",style:{minWidth:"23%",padding:"1.2em",paddingBottom:"1.2em",margin:"1em",marginBottom:"0.5em",marginTop:"0.5em",height:"auto"},children:[(0,a.jsx)(Z.Z,{style:{fontSize:"20px",marginRight:"8px"}}),"Add Recommendations to Glossary"]}),B&&(0,a.jsxs)("p",{style:{paddingLeft:"1em",marginTop:"1em"},children:["Instructions have been added to ","",(0,a.jsx)("span",{style:{cursor:"pointer",color:"#1890ff",textDecoration:"underline",fontWeight:"bold"},onClick:()=>h.push("/align-model"),children:"glossary"})," ","successfully."]})]})]})]})})};var N=n(92233);let A=()=>{let e="Yelp,Restaurants".split(","),[t,n]=(0,s.useState)(null),[h,m]=(0,s.useState)(),[g,y]=(0,s.useState)([]),[f,x]=(0,s.useState)([]),[j,k]=(0,s.useState)([]),[b,w]=(0,s.useState)(""),[v,S]=(0,s.useState)(""),[C,F]=(0,s.useState)(""),[_,Z]=(0,s.useState)(!1),[T,A]=(0,s.useState)("");(0,s.useEffect)(()=>{let t=localStorage.getItem("defogDbSelected"),a=localStorage.getItem("defogToken");t?n(t):n(e[0]),m(a)},[]),(0,s.useEffect)(()=>{t&&localStorage.setItem("defogDbSelected",t),I(h,t),P()},[h,t]);let I=async(e,t)=>{if(!e)return;let n=await fetch((0,i.Z)("http","get_feedback"),{method:"POST",body:JSON.stringify({token:e,key_name:t}),headers:{"Content-Type":"application/json"}}),a=await n.json();y(a.columns),x(a.data)},E=async(e,t)=>{let n=await fetch((0,i.Z)("http","integration/get_glossary_golden_queries"),{method:"POST",body:JSON.stringify({token:e,key_name:t}),headers:{"Content-Type":"application/json"}}),a=await n.json();return{glossary:a.glossary||"",goldenQueries:a.golden_queries||""}},L=async()=>{if(!h||!t)return;let{glossary:e}=await E(h,t);return e},P=async()=>{if(!h||!t)return;let{goldenQueries:e}=await E(h,t);k(e)},Q=async(e,t,n)=>{w(e),S(t),F(n),Z(!0)};return(0,a.jsxs)("div",{className:"flex justify-center",children:[(0,a.jsx)(o.Z,{}),(0,a.jsxs)(r.Z,{id:"view-feedback",userType:"admin",children:[e.length>1?(0,a.jsx)(l.Z,{type:"flex",height:"100vh",children:(0,a.jsx)(d.Z,{span:24,style:{paddingBottom:"1em"},children:(0,a.jsx)(c.Z,{style:{width:"100%"},onChange:e=>{n(e)},options:e.map(e=>({value:e,key:e,label:e})),value:t})})}):null,(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center flex-col m-3",children:[(0,a.jsxs)("h1",{children:[(0,a.jsx)(N.Z,{style:{fontSize:"3em",color:"#1890ff"}})," "]}),(0,a.jsx)("h1",{className:"text-2xl mt-4",children:"Feedback History"})]}),(0,a.jsx)(l.Z,{className:"flex justify-center mb-4",children:(0,a.jsx)(d.Z,{span:24,children:(0,a.jsx)(u.Z,{placeholder:"Filter rows by text",onChange:e=>{A(e.target.value)},className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200"})})}),(0,a.jsx)(p,{token:h,apiKeyName:t,feedbackColumns:g,feedback:f,filter:T,goldenQueries:j,setGoldenQueries:k,handleNegativeFeedback:Q}),_&&(0,a.jsx)(q,{isModalVisible:_,setIsModalVisible:Z,token:h,apiKeyName:t,question:b,sqlGenerated:v,userFeedback:C,getCurrentGlossary:L})]})]})]})};var I=A},93146:function(e,t){"use strict";let n=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost"),""!==t)?"ws"===e?"".concat("http://localhost".replace("http","ws"),"/").concat(t):"".concat("http://localhost","/").concat(t):"".concat("http://localhost")};t.Z=n}},function(e){e.O(0,[435,919,412,629,592,13,738,502,774,888,179],function(){return e(e.s=86244)}),_N_E=e.O()}]);