(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{41599:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/oracle-frontend",function(){return s(70194)}])},26335:function(e,t,s){"use strict";var a=s(28598),l=s(1887),o=s.n(l);t.Z=()=>(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,t,s){"use strict";var a=s(28598),l=s(82684),o=s(97574),r=s(79869),n=s(34376);s(12691);var i=s(26978),c=s(47663),d=s(56572);t.Z=e=>{let{id:t,userType:s,children:u,rootClassNames:h="",contentClassNames:m=""}=e,{Content:f,Sider:p}=r.Layout,[g,x]=(0,l.useState)([]),[y,N]=(0,l.useContext)(o.S),j=(0,n.useRouter)(),redirect=e=>{j.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),N({user:null,token:null,userType:null}),redirect("/static/log-in.html")},k=(0,c.usePathname)();(0,l.useEffect)(()=>{x(("admin"==s?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:s?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==k,e)))},[s]);let[b,v]=(0,l.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,l.useEffect)(()=>{"/query-data"===k&&v("flex flex-col md:min-h-screen relative")},[k]),(0,a.jsxs)("div",{className:(0,d.m6)(b,h),children:[g.length?(0,a.jsx)(i.l2,{rootClassNames:"border-b",items:g}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:(0,d.m6)("grow",m),children:u})]})}},70194:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return oracle_frontend}});var a=s(28598),l=s(20259),o=s.n(l),r=s(33612),n=s(37490),i=s(92696),c=s(24788),d=s(49603),u=s(82684),h=s(26335),m=s(82067),f=s(66079),p=s(61252),g=s(60071),x=s.n(g);function Sources(e){let{sources:t,setSources:s}=e;return 0===t.length?null:(0,a.jsxs)("div",{className:"bg-white flex w-full flex-col",children:[(0,a.jsx)("div",{className:"flex items-start gap-4 pb-3",children:(0,a.jsxs)("h3",{className:"text-base font-bold leading-6 text-black",children:["Suggested Sources"," "]})}),(0,a.jsx)("div",{className:"flex w-full items-center overflow-x-scroll gap-6 pb-3",children:t.map(e=>(0,a.jsx)(SourceCard,{source:e,setSources:s}))})]})}let SourceCard=e=>{let{source:t,setSources:s}=e,[l,o]=(0,u.useState)(t.selected);return(0,a.jsx)("div",{className:'"flex h-[79px] w-full items-center gap-2.5 rounded-lg border border-gray-100 px-1.5 py-1 shadow-md '.concat(l?"bg-gray-100 opacity-50":"bg-white"),children:(0,a.jsxs)("div",{className:"flex items-center relative",children:[(0,a.jsx)("span",{className:"shrink-0",children:(0,a.jsx)(x(),{unoptimized:!0,src:"https://www.google.com/s2/favicons?domain=".concat(t.link,"&sz=128"),alt:t.link,className:"rounded-full p-1",width:36,height:36})}),(0,a.jsxs)("span",{className:"flex min-w-0 max-w-[192px] flex-col justify-center gap-1 ml-2 mt-2",children:[(0,a.jsx)("h6",{className:"line-clamp-2 text-xs font-light",children:t.title}),(0,a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:t.link,className:"truncate text-xs font-light text-[#1B1B16]/30",children:t.link})]}),(0,a.jsx)("div",{className:"ml-auto cursor-pointer top-2 right-2",onClick:()=>{o(!l),s(e=>e.map(e=>e.position===t.position?{...e,selected:!l}:e))},children:l?(0,a.jsx)(p.default,{style:{color:"green"}}):(0,a.jsx)(f.default,{})})]})})};var y=s(79204),N=s(13966),j=s(55658),k=s(82098),b=s(48497),oracle_frontend=function(){let e=(b.env.NEXT_PUBLIC_API_KEY_NAMES||"REPLACE_WITH_API_KEY_NAMES").split(","),[t,s]=(0,u.useState)(e[0]),[l,f]=(0,u.useState)(""),[p,g]=(0,u.useState)([]),[x,v]=(0,u.useState)(!1),[w,_]=(0,u.useState)([]),[S,T]=(0,u.useState)(!1),[C,E]=(0,u.useState)(!1),[I,P]=(0,u.useState)([]),getClarifications=async()=>{v(!0);let e=localStorage.getItem("defogToken"),s=await fetch((0,y.Z)("http","oracle/clarify_formulation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t,question:l})});if(v(!1),s.ok){let e=await s.json();g(e.clarifications),E(e.ready)}else console.error("Failed to fetch clarifications")},deleteClarification=e=>{g(t=>t.filter((t,s)=>s!==e))},getSources=async()=>{T(!0);let e=localStorage.getItem("defogToken"),s=await fetch((0,y.Z)("http","oracle/suggest_web_sources"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t,question:l})});if(T(!1),s.ok){let e=await s.json(),t=e.organic;t.forEach(e=>{e.selected=!1}),_(t)}else console.error("Failed to fetch sources")},checkAllFinished=e=>e.every(e=>"done"===e.status||"error"===e.status),getReports=async()=>{let e=localStorage.getItem("defogToken"),pollReports=async()=>{try{let a=await fetch((0,y.Z)("http","oracle/list_reports"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t})});if(a.ok){let e=await a.json();P(e.reports),checkAllFinished(e.reports)&&clearInterval(s)}else console.error("Failed to fetch reports"),clearInterval(s)}catch(e){console.error("An error occurred:",e),clearInterval(s)}},s=setInterval(pollReports,1e3);pollReports()},deleteReport=async e=>{let s=localStorage.getItem("defogToken"),a=await fetch((0,y.Z)("http","oracle/delete_report"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s,key_name:t,report_id:I[e].report_id})});a.ok&&getReports()},generateReport=async()=>{let e=localStorage.getItem("defogToken"),s=w.filter(e=>e.selected);console.log(s);let a=await fetch((0,y.Z)("http","oracle/begin_generation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t,question:l,sources:s})});a.ok&&getReports()};return(0,u.useEffect)(()=>{let e=setTimeout(()=>{l.length<5?console.log("User task is too short, not fetching clarifications yet"):(getClarifications(),getSources())},3e3);return()=>clearTimeout(e)},[l]),(0,u.useEffect)(()=>{getReports()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{}),(0,a.jsxs)(m.Z,{id:"align-model",userType:"admin",children:[e.length>1?(0,a.jsx)(n.default,{type:"flex",height:"100vh",children:(0,a.jsx)(i.default,{span:24,style:{paddingBottom:"1em"},children:(0,a.jsx)(c.default,{style:{width:"100%"},onChange:e=>{s(e)},options:e.map(e=>({value:e,key:e,label:e})),defaultValue:t})})}):null,(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"The Oracle"}),(0,a.jsx)("p",{className:"text-gray-600",children:"The Oracle is a background assistant, helping you to dig into your dataset for insights. To begin, please let us know what you are interested in below."})]}),(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(r.default.TextArea,{placeholder:"Describe what you would like the Oracle to do...",className:"w-full p-3 border rounded-lg text-gray-700 focus:outline-none focus:border-purple-500",value:l,onChange:e=>{f(e.target.value)},autoSize:{minRows:2,maxRows:10},style:{flexBasis:"90%"}}),(0,a.jsx)("div",{className:"ml-2",children:x?(0,a.jsx)(d.default,{}):l&&(C?(0,a.jsx)(N.Z,{style:{color:"green"}}):(0,a.jsx)(j.Z,{style:{color:"#808080"}}))})]}),p.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Clarifications"}),p.map((e,t)=>(0,a.jsxs)("div",{className:"bg-amber-100 p-4 rounded-lg mb-4 relative",children:[(0,a.jsx)("p",{className:"text-amber-500",children:e}),(0,a.jsx)(k.default,{className:"text-amber-500 absolute top-2 right-2 cursor-pointer",onClick:()=>deleteClarification(t)})]},t))]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(Sources,{sources:w,setSources:_})}),(0,a.jsx)(o(),{className:"bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600",onClick:generateReport,children:"Generate"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Past Reports"}),I.map((e,t)=>(0,a.jsxs)("div",{className:"bg-purple-100 p-4 rounded-lg mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:e.report_id}),(0,a.jsx)("p",{className:"text-purple-700",children:e.report_name}),(0,a.jsx)("p",{className:"text-gray-600",children:e.status}),(0,a.jsxs)("p",{className:"text-gray-400",children:["Generated at ",e.date_created]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{className:"text-purple-700 hover:text-purple-900",children:"Download"}),(0,a.jsx)("button",{className:"text-purple-700 hover:text-purple-900",onClick:()=>deleteReport(t),children:"Delete"})]})]},t))]})]})]})}},79204:function(e,t,s){"use strict";var a=s(48497);t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT),""!==t)?"ws"===e?"".concat((a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(t):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(t):"".concat(a.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},function(e){e.O(0,[435,200,774,888,179],function(){return e(e.s=41599)}),_N_E=e.O()}]);