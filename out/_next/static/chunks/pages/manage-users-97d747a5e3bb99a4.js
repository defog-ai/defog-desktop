(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{4139:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return t(13957)}])},42449:function(e,s,t){"use strict";var a=t(28598),r=t(1887),n=t.n(r);let l=()=>(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]});s.Z=l},22500:function(e,s,t){"use strict";var a=t(28598),r=t(82684),n=t(36189),l=t(79869),o=t(34376);t(12691);var c=t(26978),i=t(47663),d=t(56572);let u=e=>{let{id:s,userType:t,children:u,rootClassNames:m="",contentClassNames:h=""}=e,{Content:p,Sider:y}=l.Ar,[f,g]=(0,r.useState)([]),[x,w]=(0,r.useContext)(n.S),j=(0,o.useRouter)(),k=e=>{j.push(e)},b=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),w({user:null,token:null,userType:null}),k("/log-in")},Z=(0,i.usePathname)();(0,r.useEffect)(()=>{g(("admin"==t?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:t?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:[]).map(e=>(e.current=e.href==Z,e)))},[t]);let[v,T]=(0,r.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,r.useEffect)(()=>{"/query-data"===Z&&T("flex flex-col md:min-h-screen relative")},[Z]),(0,a.jsxs)("div",{className:(0,d.m6)(v,m),children:[f.length?(0,a.jsx)(c.l2,{rootClassNames:"border-b",items:f}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:(0,d.m6)("grow",h),children:u})]})};s.Z=u},13957:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var a=t(28598),r=t(82684),n=t(34376),l=t(42449),o=t(22500),c=t(36189),i=t(93146),d=t(56823),u=t(16496),m=t(46286),h=t(80128),p=t(20673),y=t(4134),f=t(35173),g=t(54213),x=t(28718),w=t.n(x);let{Title:j}=d.Z,k=e=>{let{loading:s,context:t,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[c,d]=(0,r.useState)("username,password,user_type\n"),[x,k]=(0,r.useState)(""),[b,Z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]),(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]);let v=e=>(w().parse(e,{error:e=>{u.ZP.error("There was an error parsing the CSV file.")},complete:e=>{let s=e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}));o(s),Z(!0),k(""),u.ZP.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),T=async e=>{try{let s="username,password,user_type"!==c.trim()?"admin/add_users_csv":"admin/add_users",a="username,password,user_type"!==c.trim()?{users_csv:c,token:t.token}:{...e,token:t.token},r=await fetch((0,i.Z)("http",s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let l=await r.json();if("success"===l.status)u.ZP.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}]);else throw Error(l.message||"There was an error adding the users.");await n()}catch(m){console.error("Error:",m),u.ZP.error(m.message||"There was an error adding the users. Please try again.")}finally{Z(!1),d("username,password,user_type\n")}};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,a.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,a.jsx)(f.Z,{className:"mr-2"}),"Add Users via File"]}),(0,a.jsxs)(m.Z,{layout:"vertical",disabled:s,onFinish:T,children:[(0,a.jsx)(j,{level:4,children:"Option 1: Paste Google Sheets URL"}),(0,a.jsx)(m.Z.Item,{label:"Google Sheets URL",name:"gsheets_url",children:(0,a.jsx)(h.Z,{className:"pd-2",value:x,onChange:e=>k(e.target.value)})}),(0,a.jsx)(j,{level:4,className:"mt-6",children:"Option 2: Upload CSV File"}),(0,a.jsx)(m.Z.Item,{label:b?"":"Expected columns in the file: username,password,user_type",children:(0,a.jsx)(p.Z,{beforeUpload:v,accept:".csv",showUploadList:!1,disabled:b,children:(0,a.jsx)(y.ZP,{icon:(0,a.jsx)(g.Z,{}),disabled:b,children:b?"Uploaded":"Upload CSV"})})}),b&&(0,a.jsx)(m.Z.Item,{label:"Generated CSV String",className:"mt-4",children:(0,a.jsx)(h.Z.TextArea,{value:c,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,a.jsx)(m.Z.Item,{children:(0,a.jsx)(y.ZP,{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block",disabled:"username,password,user_type"===c.trim()&&!x,children:"Add Users"})})]})]})};var b=t(56193),Z=t(39813);let{Option:v}=b.Z,T=e=>{let{loading:s,context:t,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[c,d]=(0,r.useState)("username,password,user_type\n");(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]);let p=(e,s,t)=>{let a=[...l];a[e][s]=t,o(a)},f=async()=>{let e=await fetch((0,i.Z)("http","admin/add_users_csv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:c,token:t.token})}),s=await e.json();"success"===s.status?(u.ZP.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}])):u.ZP.error("There was an error adding the users. Please try again."),await n()};return(0,a.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,a.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,a.jsx)(Z.Z,{className:"mr-2"}),"Add Users Manually"]}),(0,a.jsxs)(m.Z,{layout:"vertical",disabled:s,onFinish:f,className:"w-full",children:[l.map((e,s)=>(0,a.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,a.jsx)(m.Z.Item,{label:"Username",name:"username".concat(s),required:!0,className:"w-1/3",children:(0,a.jsx)(h.Z,{className:"border border-gray-200 h-9 rounded-md",value:e.username,onChange:e=>p(s,"username",e.target.value)})}),(0,a.jsx)(m.Z.Item,{label:"Password",name:"password".concat(s),required:!0,className:"w-1/3",children:(0,a.jsx)(h.Z.Password,{className:"h-9",value:e.password,onChange:e=>p(s,"password",e.target.value)})}),(0,a.jsx)(m.Z.Item,{label:"User Type",name:"userType".concat(s),required:!0,className:"w-1/3",children:(0,a.jsxs)(b.Z,{value:e.userType,onChange:e=>p(s,"userType",e),className:"h-9",children:[(0,a.jsx)(v,{value:"admin",children:"Admin"}),(0,a.jsx)(v,{value:"general",children:"General"})]})})]},s)),(0,a.jsx)(y.ZP,{type:"dashed",onClick:()=>o([...l,{username:"",password:"",userType:""}]),block:!0,children:"Add Another User"}),"username,password,user_type"!==c.trim()&&(0,a.jsx)(m.Z.Item,{label:"Generated CSV String",className:"mt-4",children:(0,a.jsx)(h.Z.TextArea,{value:c,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,a.jsx)(m.Z.Item,{children:(0,a.jsx)(y.ZP,{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block mt-20",disabled:"username,password,user_type"===c.trim(),children:"Add Users"})})]})]})};var N=t(42634),S=t(42339),_=t(21013),P=t(32062),U=t(4183);let C=e=>{let{userDets:s,context:t,getUserDets:r,loading:n,setLoading:l}=e,o=e=>{N.Z.confirm({title:"Are you sure you want to delete this user?",content:"User: ".concat(e),okText:"Yes",okType:"danger",cancelText:"No",className:"w-1/3",onOk:async()=>{l(!0);let s=await fetch((0,i.Z)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:t.token}),headers:{"Content-Type":"application/json"}}),a=await s.json();"success"===a.status?u.ZP.success("User deleted successfully! Refreshing the user data..."):u.ZP.error("There was an error deleting the user. Please try again."),await r(),l(!1)}})};return(0,a.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,a.jsx)(S.Z,{spinning:n,tip:"Getting Latest Users Data",children:(0,a.jsx)(_.Z,{className:"mt-10 border border-gray-200 rounded-lg shadow-lg bg-gray-100",dataSource:s,columns:[{title:"User ID",dataIndex:"username",key:"username",width:"33%",align:"center"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"33%",align:"center"},{title:"Action",key:"delete_user",width:"33%",align:"center",render:(e,s)=>(0,a.jsx)(P.Z,{size:"middle",children:(0,a.jsx)(y.ZP,{type:"default",icon:(0,a.jsx)(U.Z,{}),onClick:()=>o(s.username)})})}]})})})};var I=t(62071);let A=()=>{let[e,s]=(0,r.useState)(!1),[t,d]=(0,r.useState)([]),[m,h]=(0,r.useContext)(c.S),p=(0,n.useRouter)(),y=async()=>{if(s(!0),!m.token)return;let e=await fetch((0,i.Z)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:m.token}),headers:{"Content-Type":"application/json"}}),t=await e.json();t.users?d(t.users):u.ZP.error("There was an error fetching the user data. Please try again."),s(!1)};return(0,r.useEffect)(()=>{let e=m.token,s=m.userType;if(!s){let t=localStorage.getItem("defogUser");if(e=localStorage.getItem("defogToken"),s=localStorage.getItem("defogUserType"),!t||!e||!s){p.push("/log-in");return}h({user:t,token:e,userType:s})}e?y():p.push("/log-in")},[m,m.token]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{}),(0,a.jsxs)(o.Z,{id:"manage-users",userType:"admin",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,a.jsxs)("h1",{children:[(0,a.jsx)(I.Z,{style:{fontSize:"3.5em",color:"#1890ff"}})," "]}),(0,a.jsx)("h1",{className:"text-3xl mt-4",children:"Manage Users"})]}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,a.jsx)(C,{userDets:t,context:m,getUserDets:y,loading:e,setLoading:s})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,a.jsx)(k,{loading:e,context:m,getUserDets:y})}),(0,a.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,a.jsx)(T,{loading:e,context:m,getUserDets:y})})]})]})};var E=A},93146:function(e,s){"use strict";let t=(e,s)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost:33364"),""!==s)?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(s):"".concat("http://localhost:33364","/").concat(s):"".concat("http://localhost:33364")};s.Z=t}},function(e){e.O(0,[435,919,412,629,592,13,738,286,611,425,774,888,179],function(){return e(e.s=4139)}),_N_E=e.O()}]);