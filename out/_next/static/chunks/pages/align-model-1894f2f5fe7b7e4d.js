(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[224],{35334:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"}},11030:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"}},19737:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"}},40409:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"}},4559:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"}},13966:function(e,t,a){"use strict";var s=a(79290).default,n=a(44512).default;t.Z=void 0;var l=n(a(17963)),o=s(a(82684)),r=n(a(35334)),i=n(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,l.default)({},e,{ref:t,icon:r.default}))});t.Z=d},41271:function(e,t,a){"use strict";var s=a(79290).default,n=a(44512).default;t.Z=void 0;var l=n(a(17963)),o=s(a(82684)),r=n(a(11030)),i=n(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,l.default)({},e,{ref:t,icon:r.default}))});t.Z=d},89513:function(e,t,a){"use strict";var s=a(79290).default,n=a(44512).default;t.Z=void 0;var l=n(a(17963)),o=s(a(82684)),r=n(a(19737)),i=n(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,l.default)({},e,{ref:t,icon:r.default}))});t.Z=d},66093:function(e,t,a){"use strict";var s=a(79290).default,n=a(44512).default;t.Z=void 0;var l=n(a(17963)),o=s(a(82684)),r=n(a(40409)),i=n(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,l.default)({},e,{ref:t,icon:r.default}))});t.Z=d},65683:function(e,t,a){"use strict";var s=a(79290).default,n=a(44512).default;t.Z=void 0;var l=n(a(17963)),o=s(a(82684)),r=n(a(4559)),i=n(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,l.default)({},e,{ref:t,icon:r.default}))});t.Z=d},81659:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/align-model",function(){return a(72463)}])},22295:function(e,t,a){"use strict";var s=a(28598),n=a(82684),l=a(33612),o=a(51728);t.Z=e=>{let{helperText:t,mainText:a,onUpdate:r,isEditable:i,inputModeOn:d=!1}=e,[c,u]=(0,n.useState)(a),[m,p]=(0,n.useState)(d),handleUpdate=()=>{r(c),p(!1)};return(0,s.jsxs)("div",{style:{backgroundColor:"#FFFAF0",borderLeft:"5px solid #FFA500",padding:"10px",margin:"10px 0",fontFamily:"Monospace",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{children:[t,"\xa0"]}),m?(0,s.jsx)(l.default,{value:c,onChange:e=>u(e.target.value),onPressEnter:handleUpdate,onBlur:handleUpdate,autoFocus:!0,style:{flex:1}}):(0,s.jsx)("span",{style:{flex:1},children:c}),i&&(0,s.jsx)(o.default,{onClick:()=>p(!m),style:{cursor:"pointer",color:"#FFA500",marginLeft:"10px"}})]})}},26335:function(e,t,a){"use strict";var s=a(28598),n=a(1887),l=a.n(n);t.Z=()=>(0,s.jsxs)(l(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,t,a){"use strict";var s=a(28598),n=a(82684),l=a(97574),o=a(79869),r=a(34376);a(12691);var i=a(26978),d=a(47663),c=a(56572);t.Z=e=>{let{id:t,userType:a,children:u,rootClassNames:m="",contentClassNames:p=""}=e,{Content:f,Sider:h}=o.Layout,[g,y]=(0,n.useState)([]),[x,_]=(0,n.useContext)(l.S),b=(0,r.useRouter)(),redirect=e=>{b.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),_({user:null,token:null,userType:null}),redirect("/static/log-in.html")},j=(0,d.usePathname)();(0,n.useEffect)(()=>{y(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==j,e)))},[a]);let[v,w]=(0,n.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,n.useEffect)(()=>{("/query-data"===j||"/static/query-data.html"===j)&&w("flex flex-col md:min-h-screen relative")},[j]),(0,s.jsxs)("div",{className:(0,c.m6)(v,m),children:[g.length?(0,s.jsx)(i.l2,{rootClassNames:"border-b",items:g}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:(0,c.m6)("grow",p),children:u})]})}},37972:function(e,t,a){"use strict";var s=a(28598);t.Z=function(e){let{columns:t,data:a}=e;return(0,s.jsx)("div",{className:"max-w-full max-h-screen overflow-auto",children:(0,s.jsxs)("table",{className:"min-w-full border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:t.map((e,t)=>(0,s.jsx)("th",{className:"border px-8 py-2 bg-gray-200 text-center",children:e},t))})}),(0,s.jsx)("tbody",{children:a.map((e,t)=>(0,s.jsx)("tr",{children:e.map((e,t)=>(0,s.jsx)("td",{className:"border px-8 py-2 text-center",children:e.toString()},t))},t))})]})})}},72463:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return align_model}});var s=a(28598),n=a(82684),l=a(26335),o=a(82067),r=a(79204),i=a(20259),d=a.n(i),c=a(49603),align_model_Instructions=e=>{let{title:t,description:a,glossary:n,setGlossary:l,updateGlossary:o,updateGlossaryLoadingFunction:r,isLoading:i,isUpdatingInstructions:u}=e;return(0,s.jsxs)("div",{className:"w-full p-4 bg-gray-50 mb-5",children:[(0,s.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:t}),(0,s.jsx)("p",{className:"mb-4 text-gray-700",children:a}),(0,s.jsx)(c.default,{spinning:i||u,tip:u?"Updating Instructions...":"Loading Instructions",children:(0,s.jsx)("textarea",{className:"w-full h-40 p-2 border rounded border-gray-300 shadow-sm focus:border-gray-500 focus:ring focus:ring-gray-200 transition duration italic",value:n,onChange:e=>l(e.target.value),rows:8,disabled:i})}),(0,s.jsx)(d(),{type:"primary",className:"mt-4 p-2 min-w-56",onClick:()=>o(n,r),disabled:i||u,children:"Update Glossary"})]})},u=a(51728),m=a(66093),p=a(89513),f=a(10998),h=a(33612),g=a(85439);let EditableCell=e=>{let{editing:t,dataIndex:a,title:n,inputType:l,record:o,index:r,children:i,...d}=e;return(0,s.jsx)("td",{...d,children:t?(0,s.jsx)(g.default.Item,{name:a,className:"m-0",children:"column_description"===a?(0,s.jsx)(h.default.TextArea,{autoSize:{minRows:3},className:"max-h-32 overflow-auto p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}):(0,s.jsx)(h.default,{className:"p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})}):i})};var EditableMetadata=e=>{let{title:t,description:a,metadata:l,updateMetadata:o}=e,[r]=g.default.useForm(),[i,h]=(0,n.useState)([]),[y,x]=(0,n.useState)(""),[_,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=Object.entries(l).flatMap(e=>{let[t,a]=e;return a.map(e=>({key:"".concat(t,"-").concat(e.column_name),table_name:t,column_name:e.column_name,data_type:e.data_type,column_description:e.column_description}))});h(e)},[l]);let isEditing=e=>e.key===y,edit=e=>{r.setFieldsValue({table_name:e.table_name,column_name:e.column_name,data_type:e.data_type,column_description:e.column_description}),x(e.key)},cancel=()=>{x("")},save=async e=>{try{let t=await r.validateFields(),a=[...i],s=a.findIndex(t=>e===t.key);if(s>-1){let e=a[s];a.splice(s,1,{...e,...t}),h(a),x("")}else a.push(t),h(a),x("")}catch(e){console.log("Validate Failed:",e)}},j=[{title:"Table Name",dataIndex:"table_name",width:"20%",editable:!1},{title:"Column Name",dataIndex:"column_name",width:"20%",editable:!1},{title:"Data Type",dataIndex:"data_type",width:"15%",editable:!1},{title:"Description",dataIndex:"column_description",width:"35%",editable:!0},{title:"",dataIndex:"action",width:"5%",align:"center",render:(e,t)=>{let a=isEditing(t);return a?(0,s.jsxs)("span",{className:"flex space-x-3 justify-center",children:[(0,s.jsx)(m.Z,{onClick:()=>save(t.key),className:"text-blue-500 hover:text-blue-700 cursor-pointer text-xl"}),(0,s.jsx)(p.Z,{onClick:cancel,className:"text-red-500 hover:text-red-700 cursor-pointer text-xl"})]}):(0,s.jsx)(u.default,{disabled:""!==y,onClick:()=>edit(t),className:"".concat(""===y?"text-yellow-500 hover:text-yellow-700 cursor-pointer text-xl":"text-gray-400")})}}],v=j.map(e=>e.editable?{...e,onCell:t=>({record:t,inputType:"column_description"===e.dataIndex?"textarea":"text",dataIndex:e.dataIndex,title:e.title,editing:isEditing(t)})}:e);return(0,s.jsxs)("div",{className:"w-full p-4 bg-gray-50",children:[(0,s.jsx)("h1",{className:"text-xl mb-3 font-semibold",children:t}),(0,s.jsx)("p",{className:"mb-4 text-gray-700",children:a}),(0,s.jsx)(g.default,{form:r,component:!1,children:(0,s.jsx)(c.default,{spinning:_,tip:"Updating Metadata",children:(0,s.jsx)(f.default,{components:{body:{cell:EditableCell}},bordered:!0,dataSource:i,columns:v,rowClassName:"editable-row",pagination:{position:["bottomCenter"]},footer:()=>(0,s.jsx)(d(),{type:"primary",className:"mt-4 p-2 min-w-56",onClick:async()=>await o(i,b),disabled:_,children:_?"Updating Metadata":"Update Metadata"})})})})]})},y=a(29807),x=a(40759),align_model_ResultsPercentages=e=>{let{validPctList:t,correctPctList:a,overallPctList:n}=e,l=["Current Glossary and Metadata","Optimized Glossary and Current Metadata","Current Glossary and Optimized Metadata","Optimized Glossary and Optimized Metadata"];return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-lg mb-4",children:"Percentages:"}),t.map((e,t)=>{let o=a[t];return n[t],(0,s.jsxs)(x.default,{className:"mb-4 shadow-lg border border-gray-200",bodyStyle:{padding:"20px"},style:{borderRadius:"10px"},children:[(0,s.jsx)("div",{className:"mb-4 text-center",children:(0,s.jsx)("h5",{className:"font-semibold text-xl",children:l[t]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-600 mb-2",children:"Validity:"}),(0,s.jsx)(y.default,{percent:e,strokeColor:"#1890ff"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-600 mb-2",children:"Correctness:"}),(0,s.jsx)(y.default,{percent:o,strokeColor:"#52c41a"})]})]})]},t)})]})},_=a(18953),b=a(22399),j=a(64283),v=a(13966),w=a(41271),align_model_IMGO=e=>{let{token:t,apiKeyName:a,updateGlossary:l,updateMetadata:o}=e,[i,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),[f,h]=(0,n.useState)(!1),[g,y]=(0,n.useState)({}),[N,k]=(0,n.useState)(null),S=(0,n.useRef)(null),C=(0,n.useRef)(null),[G,M]=(0,n.useState)(""),[T,E]=(0,n.useState)(null),[z,O]=(0,n.useState)(!1),I=[{title:"Use Current Metadata and Glossary",description:"Generate, validate, and correct golden queries using the current metadata and glossary. Then optimize both."},{title:"Use Optimized Glossary and Current Metadata",description:"Generate, validate, and correct golden queries using the optimized glossary from the first iteration."},{title:"Use Optimized Metadata and Current Glossary",description:"Generate, validate, and correct golden queries using the optimized metadata from the first iteration."},{title:"Use Optimized Metadata and Optimized Glossary",description:"Generate, validate, and correct golden queries using both the optimized metadata and glossary from previous iterations."}],q=[{name:"Generate Golden Queries",endpoint:"generate_golden_queries_from_questions",payload:()=>({token:t,key_name:a,max_num_queries:4,db_type:"postgres",optimized_glossary:null,optimized_metadata:null})},{name:"Check Validity of the Generated Queries",endpoint:"check_generated_golden_queries_validity",payload:()=>({token:t,key_name:a,db_type:"postgres",optimized_glossary:null,optimized_metadata:null})},{name:"Check Correctness of the Generated Queries",endpoint:"check_generated_golden_queries_correctness",payload:()=>({token:t,key_name:a,db_type:"postgres",optimized_glossary:null,optimized_metadata:null})}],P=[{name:"Optimize Glossary",endpoint:"optimize_glossary",payload:()=>({token:t,key_name:a})},{name:"Optimize Metadata",endpoint:"optimize_metadata",payload:()=>({token:t,key_name:a})}],Q={name:"Recommendations for Glossary and Metadata",endpoint:"get_recommendation_for_glossary_and_metadata",payload:()=>({token:t,key_name:a,db_type:"postgres"})};(0,n.useEffect)(()=>{console.log("Renderinng IMGO modal visible state:",i),i&&executeWorkflow()},[i]);let executeWorkflow=async()=>{h(!0);try{for(let e=0;e<I.length;e++){let t=0===e?[...q,...P]:q;for(let a of t)await handleApiRequest(a,e)}await handleFinalRecommendations()}catch(e){console.error("Error during IMGO workflow:",e),_.default.error("Failed during IMGO workflow.")}finally{h(!1)}},handleApiRequest=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="".concat(e.name," ").concat(I[s].title);p(n);let l=e.payload();1===s?(l.optimized_glossary=S.current,M(S.current)):2===s?(l.optimized_metadata=C.current,E(C.current)):3===s&&(l.optimized_glossary=S.current,M(S.current),l.optimized_metadata=C.current,E(C.current));try{let s=await fetch((0,r.Z)("http",e.endpoint),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await s.json();"Optimize Glossary"===e.name?S.current=o.optimized_glossary:"Optimize Metadata"===e.name&&(C.current=o.optimized_metadata);let i={...o};delete i.task_id,y(e=>({...e,[n]:i})),e.onSuccess&&e.onSuccess(i);let{task_id:d}=o;if(d){let pollTaskStatus=async e=>{console.log("starting polling now");let s=!1;for(;!s;){let n=await fetch((0,r.Z)("http","check_task_status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,key_name:a,task_id:e})}),l=await n.json();if("completed"===l.status){s=!0;break}if("not_found"===l.status)return!1;await new Promise(e=>setTimeout(e,1e4))}return s},s=await pollTaskStatus(d);if(s){let t={...o,finalmessage:"Task completed successfully ✅"};delete t.task_id,y(e=>({...e,[n]:t})),e.onSuccess&&e.onSuccess(t)}}}catch(e){console.error("Error executing step ".concat(n,":"),e),_.default.error("Failed to execute step ".concat(n,"."))}finally{p(null)}},handleFinalRecommendations=async()=>{try{let e=await fetch((0,r.Z)("http",Q.endpoint),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q.payload())}),t=await e.json();k(t)}catch(e){console.error("Error fetching final recommendations:",e),_.default.error("Failed to fetch final recommendations.")}},onClose=()=>{u(!1),h(!1),y({}),k(null),S.current=null,C.current=null};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d(),{onClick:()=>u(!0),className:"w-full",children:"Iterative Metadata and Glossary Optimisation"}),(0,s.jsx)(b.default,{title:(0,s.jsx)("div",{className:"text-2xl font-semibold text-center mt-2 mb-5",children:"Recommendations for Improving Glossary and Metadata"}),onCancel:onClose,footer:[(0,s.jsx)(d(),{onClick:onClose,style:{width:"100%"},children:"Close"},"close")],width:"75%",className:"max-h-full overflow-y-auto",open:i,children:(0,s.jsxs)("div",{className:"space-y-4",children:[N?(0,s.jsxs)(x.default,{title:"Results",className:"bg-white shadow-md",children:[(0,s.jsx)("p",{className:"mb-2 font-semibold",children:(console.log(N),N.is_glossary_optimization_recommended&&N.is_metadata_optimization_recommended)?"Recommendations: Focus on improving both Metadata and Glossary.":N.is_glossary_optimization_recommended?"Recommendations: Focus on improving Glossary.":N.is_metadata_optimization_recommended?"Recommendations: Focus on improving Metadata.":"We do not have any recommendations for you at this point. Please add more golden queries and check back."}),N.is_glossary_optimization_recommended&&(0,s.jsx)(align_model_Instructions,{title:"Optimized Glossary",description:"These are the optimized glossary recommendations. You can edit them below before accepting changes.",glossary:G,setGlossary:M,updateGlossary:l,updateGlossaryLoadingFunction:O,isLoading:!1,isUpdatingInstructions:z}),N.is_metadata_optimization_recommended&&(0,s.jsx)(EditableMetadata,{title:"Optimised Metadata",description:"These are the suggested descriptions for each column in the database. You can edit them below before updating the metadata.",metadata:T,updateMetadata:o}),N&&N.valid_pct_list&&N.correct_pct_list&&(0,s.jsx)(align_model_ResultsPercentages,{validPctList:N.valid_pct_list,correctPctList:N.correct_pct_list,overallPctList:N.overall_list})]}):(0,s.jsx)(c.default,{children:(0,s.jsx)("div",{className:"text-center italic text-lg m-4 mb-5",children:f?"Please bear with us as we run multiple iterations to provide you with the best recommendations. This can take a few minutes.":""})}),I.map((e,t)=>(0,s.jsxs)("div",{className:"border border-gray-300 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4 mt-1",children:e.description}),(0===t?[...q,...P]:q).map((t,a)=>(0,s.jsxs)("div",{className:"rounded-lg flex flex-col",style:{borderBottom:a<q.length-1?"1px solid #e0e0e0":"none"},children:[(0,s.jsxs)("div",{className:"flex items-center flex-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm bg-white mt-3",children:[(0,s.jsx)("span",{style:{flexShrink:0,marginRight:"8px",color:m==="".concat(t.name," ").concat(e.title)?"orange":g["".concat(t.name," ").concat(e.title)]?"green":"red"},children:m==="".concat(t.name," ").concat(e.title)?(0,s.jsx)(c.default,{indicator:(0,s.jsx)(j.default,{style:{color:"orange"}})}):g["".concat(t.name," ").concat(e.title)]?(0,s.jsx)(v.Z,{}):(0,s.jsx)(w.Z,{})}),(0,s.jsx)("span",{className:"flex-1",children:t.name})]}),g["".concat(t.name," ").concat(e.title)]&&(0,s.jsx)("div",{className:"mt-2 bg-black text-white p-4 rounded font-mono text-sm overflow-auto max-h-96",children:Object.entries(g["".concat(t.name," ").concat(e.title)]).filter(e=>{let[t]=e;return"task_id"!==t}).map((e,t)=>{let[a,n]=e;return(0,s.jsx)("div",{children:"object"==typeof n?(0,s.jsx)("pre",{children:JSON.stringify(n,null,2)}):(0,s.jsx)("span",{children:n})},t)})})]},a))]},t))]})})]})},N=a(35575),k=a(31585),S=a(22295),C=a(73638),G=a(37972),align_model_AddQueryModal=e=>{let{handleOk:t,handleCancel:a,newQuestion:l,setNewQuestion:o,newSql:r,setNewSql:i,newColumns:d,newData:u,generateSqlQuery:m}=e,[p,f]=(0,n.useState)(!1),onUpdate=async e=>{f(!0),o(e),i("Generating SQL...");let t=await m(e);i(t),f(!1)};return(0,s.jsxs)(b.default,{title:(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center text-xl mb-4",children:[(0,s.jsx)(C.default,{className:"text-yellow-500 mb-4 font-bold",style:{fontSize:"3em"}}),(0,s.jsx)("h1",{children:" Add Golden Query "})]}),onOk:t,onCancel:a,open:!0,className:"w-3/4",children:[(0,s.jsx)(S.Z,{helperText:"Question: ",mainText:l,onUpdate:onUpdate,isEditable:!0,inputModeOn:!0}),(0,s.jsx)(c.default,{spinning:p,tip:"Give us a few seconds..",children:(0,s.jsx)(h.default.TextArea,{placeholder:"SQL Query",value:r,onChange:e=>i(e.target.value),rows:4,className:"min-h-52 font-mono text-sm p-2 bg-gray-50 border border-gray-300"})}),r&&"Generating SQL..."!==r&&(0,s.jsx)("div",{className:"mt-5 ",children:(0,s.jsx)(G.Z,{columns:d,data:u})})]})},align_model_GoldenQueries=e=>{let{token:t,apiKeyName:a,goldenQueries:l,setGoldenQueries:o,isLoading:i,isUpdatingGoldenQueries:p,setUpdatedGoldenQueriesToggle:g}=e,[y,x]=(0,n.useState)(Array(l.length).fill(!1)),[_,b]=(0,n.useState)(!1),[j,v]=(0,n.useState)(""),[w,C]=(0,n.useState)(""),[G,M]=(0,n.useState)([]),[T,E]=(0,n.useState)([]),toggleEditMode=e=>{let t=[...y];t[e]=!t[e],x(t)},handleCancel=()=>{v(""),C(""),M([]),E([]),b(!1)},z=[{title:"Question",dataIndex:"question",key:"question",width:"30%",render:(e,t,a)=>y[a]?(0,s.jsx)(h.default.TextArea,{value:e,onChange:e=>{let t=[...l];t[a].question=e.target.value,o(t)},rows:1,disabled:i||p}):(0,s.jsx)(S.Z,{helperText:"",mainText:e,onUpdate:()=>{},isEditable:!1})},{title:"SQL Query",dataIndex:"sql",key:"sql",width:"65%",render:(e,t,a)=>y[a]?(0,s.jsx)(h.default.TextArea,{value:e,onChange:e=>{let t=[...l];t[a].sql=e.target.value,o(t)},rows:4,disabled:i||p,className:"font-mono text-sm p-2 bg-gray-50 border border-gray-300"}):(0,s.jsx)("pre",{className:"whitespace-pre-wrap bg-gray-100 max-h-72 overflow-auto",children:e})},{title:"Actions",key:"actions",width:"5%",align:"center",render:(e,t,a)=>(0,s.jsxs)(N.default,{children:[(0,s.jsx)(d(),{icon:y[a]?(0,s.jsx)(m.Z,{onClick:()=>g(e=>!e)}):(0,s.jsx)(u.default,{}),onClick:()=>toggleEditMode(a),disabled:i||p}),(0,s.jsx)(d(),{icon:(0,s.jsx)(k.default,{}),type:"primary",danger:!0,onClick:async()=>{let e=[...l];e.splice(a,1),o(e),x(y.filter((e,t)=>t!==a)),g(e=>!e)},disabled:i||p})]})}],generateAndExecuteQuery=async e=>{try{let s=await fetch((0,r.Z)("http","query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,key_name:a,question:e,previous_context:[],dev_body:!1,ignore_cache:!0})});if(!s.ok)throw Error("Failed to fetch data from server");let n=await s.json();return M(n.columns||[]),E(n.data||[]),n.query_generated||""}catch(e){return console.error("Error generating and executing query:",e),""}};return(0,s.jsxs)("div",{className:"w-full p-4 mb-4",children:[(0,s.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:"Golden Queries"}),(0,s.jsx)("p",{className:"mb-6 text-gray-700",children:"The golden queries are SQL queries used as examples by the model to learn about how your database is structured. You can see and edit them below."}),(0,s.jsx)(c.default,{spinning:i||p,tip:p?"Updating Golden Queries...":"Loading Golden Queries",children:(0,s.jsx)("div",{className:"max-h-screen overflow-auto",children:(0,s.jsx)(f.default,{columns:z,dataSource:l.map((e,t)=>({...e,key:t})),pagination:!1})})}),(0,s.jsx)(d(),{type:"primary",className:"mt-4 h-auto p-2 min-w-56",onClick:()=>b(!0),disabled:i||p,children:"Add new Question and Query"}),_&&(0,s.jsx)(align_model_AddQueryModal,{handleOk:()=>{j&&w&&(o([...l,{question:j,sql:w}]),handleCancel(),g(e=>!e))},handleCancel:handleCancel,newQuestion:j,setNewQuestion:v,newSql:w,setNewSql:C,newColumns:G,newData:T,generateSqlQuery:generateAndExecuteQuery})]})},M=a(65683),T=a(37490),E=a(92696),z=a(24788),O=a(48497),align_model=()=>{let[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(""),[d,c]=(0,n.useState)([]),[u,m]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[y,x]=(0,n.useState)(!1),[b,j]=(0,n.useState)(!1),v=(O.env.NEXT_PUBLIC_API_KEY_NAMES||"REPLACE_WITH_API_KEY_NAMES").split(","),[w,N]=(0,n.useState)(v[0]);(0,n.useEffect)(()=>{let t=localStorage.getItem("defogToken");m(t),getGlossaryGoldenQueries(e)},[e,w]),(0,n.useEffect)(()=>{updateGoldenQueries()},[b]);let getGlossaryGoldenQueries=async e=>{f(!0);let t=localStorage.getItem("defogToken");console.log("Right now, devMode is",e);try{let a=await fetch((0,r.Z)("http","integration/get_glossary_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,dev:e,key_name:w})}),s=await a.json();i(s.glossary),c(s.golden_queries),f(!1)}catch(e){console.error(e),f(!1),_.default.error("Failed to get instructions. Are you sure you have updated your database credentials?")}},updateGlossary=async(t,a)=>{a(!0);let s=await fetch((0,r.Z)("http","integration/update_glossary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glossary:t,token:u,dev:e,key_name:w})}),n=await s.json();a(!1),"success"===n.status&&_.default.success("Instructions updated successfully!")},updateGoldenQueries=async()=>{x(!0);let t=await fetch((0,r.Z)("http","integration/update_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u,golden_queries:d,dev:e,key_name:w})}),a=await t.json();x(!1),"success"===a.status&&_.default.success("Golden queries updated successfully!")},updateMetadata=async(e,t)=>{try{t(!0),console.log("metadata",e),console.log("token",u),console.log("apiKeyName",w);let a=await fetch((0,r.Z)("http","integration/update_metadata"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u,key_name:w,metadata:e})}),s=await a.json();t(!1),s.error?_.default.error(s.error||"Error updating metadata"):_.default.success("Metadata updated successfully!")}catch(e){console.error("Error saving data:",e),_.default.error("Error saving data"),t(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{}),(0,s.jsxs)(o.Z,{id:"align-model",userType:"admin",children:[v.length>1?(0,s.jsx)(T.default,{type:"flex",height:"100vh",children:(0,s.jsx)(E.default,{span:24,style:{paddingBottom:"1em"},children:(0,s.jsx)(z.default,{style:{width:"100%"},onChange:e=>{N(e)},options:v.map(e=>({value:e,key:e,label:e})),value:w})})}):null,(0,s.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-1",children:[(0,s.jsxs)("h1",{children:[(0,s.jsx)(M.Z,{style:{fontSize:"3em",color:"#1890ff"}})," "]}),(0,s.jsx)("h1",{className:"text-3xl mt-4",children:"Align Model"}),(0,s.jsx)("p",{className:"m-4",children:"Here, you can see the instructions and golden queries that the model is currently using to create SQL queries. Feel free to change them to get the best results."})]}),(0,s.jsxs)("div",{className:"flex flex-col p-1 border border-gray-3200 rounded-lg",children:[a&&d.length>0?(0,s.jsx)(align_model_IMGO,{token:u,apiKeyName:w,updateGlossary:updateGlossary,updateMetadata:updateMetadata}):null,(0,s.jsx)(align_model_Instructions,{title:"Glossary",description:"This the information about your data that the model considers when generating your SQL queries. Feel free to edit these instructions to get the best results.",glossary:a,setGlossary:i,updateGlossary:updateGlossary,updateGlossaryLoadingFunction:g,isLoading:p,isUpdatingInstructions:h}),(0,s.jsx)(align_model_GoldenQueries,{token:u,apiKeyName:w,goldenQueries:d,setGoldenQueries:c,isLoading:p,isUpdatingGoldenQueries:y,setUpdatedGoldenQueriesToggle:j})]})]})]})}},79204:function(e,t,a){"use strict";var s=a(48497);t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT),""!==t)?"ws"===e?"".concat((s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(t):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(t):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},function(e){e.O(0,[435,774,888,179],function(){return e(e.s=81659)}),_N_E=e.O()}]);