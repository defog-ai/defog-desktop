(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{86244:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/view-feedback",function(){return a(98274)}])},9857:function(e,t,a){"use strict";var s=a(28598),n=a(82684),o=a(80128),r=a(46835);let i=e=>{let{helperText:t,mainText:a,onUpdate:i,isEditable:l,inputModeOn:d=!1}=e,[c,u]=(0,n.useState)(a),[h,m]=(0,n.useState)(d),g=()=>{i(c),m(!1)},y=()=>m(!h);return(0,s.jsxs)("div",{style:{backgroundColor:"#FFFAF0",borderLeft:"5px solid #FFA500",padding:"10px",margin:"10px 0",fontFamily:"Monospace",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{children:[t,"\xa0"]}),h?(0,s.jsx)(o.Z,{value:c,onChange:e=>u(e.target.value),onPressEnter:g,onBlur:g,autoFocus:!0,style:{flex:1}}):(0,s.jsx)("span",{style:{flex:1},children:c}),l&&(0,s.jsx)(r.Z,{onClick:y,style:{cursor:"pointer",color:"#FFA500",marginLeft:"10px"}})]})};t.Z=i},42449:function(e,t,a){"use strict";var s=a(28598),n=a(1887),o=a.n(n);let r=()=>(0,s.jsxs)(o(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]});t.Z=r},22500:function(e,t,a){"use strict";var s=a(28598),n=a(82684),o=a(36189),r=a(79869),i=a(34376);a(12691);var l=a(26978),d=a(47663),c=a(56572);let u=e=>{let{id:t,userType:a,children:u,rootClassNames:h="",contentClassNames:m=""}=e,{Content:g,Sider:y}=r.Ar,[p,f]=(0,n.useState)([]),[x,j]=(0,n.useContext)(o.S),k=(0,i.useRouter)(),b=e=>{k.push(e)},w=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),j({user:null,token:null,userType:null}),b("/log-in")},v=(0,d.usePathname)();(0,n.useEffect)(()=>{f(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:w}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:w}]:[]).map(e=>(e.current=e.href==v,e)))},[a]);let[S,C]=(0,n.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,n.useEffect)(()=>{"/query-data"===v&&C("flex flex-col md:min-h-screen relative")},[v]),(0,s.jsxs)("div",{className:(0,c.m6)(S,h),children:[p.length?(0,s.jsx)(l.l2,{rootClassNames:"border-b",items:p}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:(0,c.m6)("grow",m),children:u})]})};t.Z=u},98274:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var s=a(28598),n=a(82684),o=a(42449),r=a(22500),i=a(93146),l=a(84672),d=a(30652),c=a(56193),u=a(80128),h=a(16496),m=a(4134),g=a(42339),y=a(21013);let p=e=>{let{token:t,apiKeyName:a,feedbackColumns:o,feedback:r,filter:l,goldenQueries:d,setGoldenQueries:c,handleNegativeFeedback:u}=e,[p,f]=(0,n.useState)({}),[x,j]=(0,n.useState)(!1),[k,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{w()},[d,k,r]);let w=async()=>{let e={};r.forEach(t=>{let a="".concat(t[2],"_").concat(F(t[3])),s=(d||[]).some(e=>e.question===t[2]&&F(e.sql)===F(t[3]));e[a]=s}),f(e)},v=async(e,s)=>{let n=await S(e,s);if(n)return;(d||[]).push({question:e,sql:s});let o=await fetch((0,i.Z)("http","integration/update_golden_queries"),{method:"POST",body:JSON.stringify({token:t,key_name:a,golden_queries:d}),headers:{"Content-Type":"application/json"}}),r=await o.json();return c(d),r},S=async(e,t)=>{let a=(d||[]).some(a=>{let s=F(a.sql),n=F(t),o=a.question.trim()===e.trim();return o&&s===n});return a},C=async(e,t)=>{j(!0);try{let a=await v(e,t);"success"==a.status&&h.ZP.success("Added to Golden Queries successfully!"),await w()}catch(s){console.error("Failed to add to golden queries:",s),h.ZP.error("Failed to add to Golden Queries.")}finally{j(!1),b(!k)}},F=e=>e.replace(/\s+/g," ").trim(),_=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,Z=o.map((e,t)=>"created_at"==e?{title:"Timestamp",dataIndex:e,key:e,render:e=>(0,s.jsx)("div",{style:{color:"grey"},children:new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),width:"7%",align:"center"}:"feedback_type"===e?{title:"Type",dataIndex:e,key:e,render:e=>(0,s.jsx)(m.ZP,{type:"primary",shape:"round",size:"small",style:{backgroundColor:"bad"===e.toLowerCase()?"#f5222d":"#52c41a",borderColor:"bad"===e.toLowerCase()?"#f5222d":"#52c41a",color:"#fff"},children:_(e)}),width:"5%",align:"center"}:"query_generated"===e?{title:(0,s.jsx)("div",{style:{textAlign:"center"},children:"Generated SQL Query"}),dataIndex:e,key:e,render:e=>(0,s.jsx)("pre",{style:{whiteSpace:"pre-wrap",backgroundColor:"#f4f4f4",maxHeight:"300px",overflow:"auto"},children:e}),width:"40%"}:"feedback_text"===e?{title:"Feedback Text",dataIndex:e,key:e,render:e=>(0,s.jsx)("div",{style:{color:"#FF8C00",fontFamily:"Courier, monospace",fontSize:"1.1em",maxHeight:"300px",overflow:"auto"},children:e}),width:"20%",align:"center"}:"question"===e?{title:"Question",dataIndex:e,key:e,render:(e,t)=>(0,s.jsxs)("div",{style:{maxHeight:"300px",overflow:"auto"},children:[e,t.parentQuestionText&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsxs)("span",{style:{color:"grey"},children:["Parent Question Text: ",t.parentQuestionText]})]})]}),width:"20%",align:"center"}:{title:e,dataIndex:e,key:e});Z.push({title:"Recommendation",key:"recommendation",render:(e,t)=>{let a=p["".concat(t.question,"_").concat(F(t.query_generated))];return"bad"===t.feedback_type.toLowerCase()?(0,s.jsx)(m.ZP,{onClick:()=>u(t.question,t.query_generated,t.feedback_text),style:{backgroundColor:"#4CAF50",borderColor:"#4CAF50",color:"#fff",minWidth:"95%"},children:"Improve using Feedback"}):(0,s.jsx)(m.ZP,{onClick:async()=>{try{await C(t.question,t.query_generated)}catch(e){console.error("Failed to add to golden queries:",e)}},disabled:a,style:{backgroundColor:a?"#f0e68c":"#ffd700",borderColor:a?"#f0e68c":"#ffd700",color:"#000",opacity:a?.4:1,minWidth:"95%"},children:a?"Already a Golden Query":"Add to Golden Queries"})},width:"8%",align:"center"});let T=r.filter(e=>{var t,a,s;return(null===(t=e[1])||void 0===t?void 0:t.toLowerCase().includes(null==l?void 0:l.toLowerCase()))||(null===(a=e[2])||void 0===a?void 0:a.toLowerCase().includes(null==l?void 0:l.toLowerCase()))||(null===(s=e[3])||void 0===s?void 0:s.toLowerCase().includes(null==l?void 0:l.toLowerCase()))}),q=T.map((e,t)=>{let a={};return o.forEach((t,s)=>{a[t]=e[s]}),a.key=t,a});return(0,s.jsx)(g.Z,{spinning:x,tip:"Adding to Golden Queries...",children:(0,s.jsx)("div",{className:"w-full h-full p-1 bg-gray-50 shadow rounded-lg",children:(0,s.jsx)(y.Z,{columns:Z,dataSource:q,pagination:!1,scroll:{x:!0},rowKey:"key"})})})};var f=a(34376),x=function(e){let{columns:t,data:a}=e;return(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:t.map((e,t)=>(0,s.jsx)("th",{style:{border:"1px solid #ccc",padding:"8px",backgroundColor:"#eee"},children:e},t))})}),(0,s.jsx)("tbody",{children:a.map((e,t)=>(0,s.jsx)("tr",{children:e.map((e,t)=>(0,s.jsx)("td",{style:{border:"1px solid #ccc",padding:"8px"},children:e.toString()},t))},t))})]})},j=function(e){let{query:t}=e;return(0,s.jsx)("div",{style:{backgroundColor:"#f4f4f4",padding:"10px",borderRadius:"5px",fontFamily:"monospace"},children:(0,s.jsx)("pre",{children:t})})},k=a(42634),b=a(9857),w=a(2112),v=a(21451),S=a(8301),C=a(15610),F=a(92297),_=a(10106),Z=a(85546);let{TextArea:T}=u.Z,q=e=>{let{isModalVisible:t,setIsModalVisible:a,token:o,apiKeyName:r,question:l,sqlGenerated:d,userFeedback:c,getCurrentGlossary:u}=e,h=(0,f.useRouter)(),[y,p]=(0,n.useState)(l),[q,N]=(0,n.useState)(c),[A,I]=(0,n.useState)(""),[E,L]=(0,n.useState)(""),[P,Q]=(0,n.useState)([]),[O,R]=(0,n.useState)([]),[D,G]=(0,n.useState)(!0),[U,z]=(0,n.useState)(!1),[B,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{J()},[q]);let M=()=>{I(""),L(""),R([]),Q([]),a(!1)},J=async()=>{G(!0);try{let e=await fetch((0,i.Z)("http","get_instructions_recommendation"),{method:"POST",body:JSON.stringify({token:o,key_name:r,question:y,sql_generated:d,user_feedback:q}),headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error, status = ".concat(e.status));let t=await e.json();if(t.error)throw Error(t.error);I(t.instruction_set||"")}catch(a){console.error("Failed to populate instructions:",a.message),I("Failed to load instructions due to an error.")}finally{G(!1)}},W=async e=>{let t=await fetch((0,i.Z)("http","integration/update_glossary"),{method:"POST",body:JSON.stringify({token:o,key_name:r,glossary:e}),headers:{"Content-Type":"application/json"}}),a=await t.json();return a},K=async()=>{z(!0);let e=await u(),t=e.concat(A),a=await fetch((0,i.Z)("http","query"),{method:"POST",body:JSON.stringify({token:o,key_name:r,question:y,previous_context:[],dev_body:!1,ignore_cache:!0,glossary:t}),headers:{"Content-Type":"application/json"}}),s=await a.json();L(s.query_generated),Q(s.columns),R(s.data),z(!1),console.log(s)},V=async()=>{let e=await u(),t=e.concat("\n"+A);W(t),I(""),H(!0)};return(0,s.jsx)(k.Z,{title:"",open:t,onOk:M,onCancel:M,width:"80vw",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{textAlign:"center",marginTop:"1em",marginBottom:"1em"},children:(0,s.jsxs)("div",{children:[(0,s.jsx)(w.Z,{className:"text-4xl"}),(0,s.jsx)("p",{className:"text-2xl mt-4",children:"Recommendations"})]})}),(0,s.jsx)(b.Z,{helperText:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),"\xa0 Your Feedback:"]}),mainText:c,onUpdate:e=>{N(e)},isEditable:!D}),(0,s.jsx)("p",{style:{paddingLeft:"1.1em"},children:D?"The more meaningful the feedback, the better suggestions you get! You will soon have an option to edit the feedback and doing so automatically regenerates new instructions for you!":"Based on your feedback these are the instructions when given to the model might help get the right answer. Feel free to edit before hitting ask defog again:"}),D?(0,s.jsx)(g.Z,{tip:"Aligning the model based on your feedback. This might take up to 30-60 seconds. We appreciate your patience!",children:(0,s.jsx)(T,{disabled:!0,placeholder:"Generating instructions...",style:{width:"95%",padding:"1em",margin:"1em"}})}):(0,s.jsx)(T,{value:A,onChange:e=>{I(e.target.value)},placeholder:"Instructions Appear Here",style:{width:"95%",padding:"1em",margin:"1em",minHeight:"150px"}})]}),(0,s.jsx)(b.Z,{helperText:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),"\xa0 Question:"]}),mainText:l,onUpdate:e=>p(e),isEditable:!D&&!U}),(0,s.jsx)("div",{children:(0,s.jsxs)(m.ZP,{onClick:K,type:"dashed",style:{minWidth:"23%",padding:"1.2em",paddingBottom:"1.1em",margin:"1em",marginBottom:"0.5em",marginTop:"0.5em",height:"auto"},disabled:""===A||D||U,children:[(0,s.jsx)(C.Z,{style:{fontSize:"20px",marginRight:"8px"}}),U?"Running...":"Ask Defog with Updated Instructions"]})}),!D&&E&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{width:"95%",paddingLeft:"1.1em"},children:[(0,s.jsxs)("h2",{className:"text-xl mt-4 mb-3",style:{textAlign:"left"},children:[" ",(0,s.jsx)(F.Z,{style:{fontSize:"24px",marginRight:"8px"}})," ","Updated Results Using Instructions"]}),(0,s.jsx)("h3",{className:"text-lg mt-2 mb-1 text-left",children:"Generated SQL Query"}),(0,s.jsx)(j,{query:E}),(0,s.jsx)("h3",{className:"text-lg mt-2 mb-1 text-left",children:"Query Results"}),(0,s.jsx)(x,{columns:P,data:(O||[]).map(e=>e.map(e=>e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b.Z,{helperText:(0,s.jsx)(_.Z,{style:{fontSize:"16px",color:"##FFFAF0"}}),mainText:"Did this improve your results? If yes, consider adding those instructions to the glossary permanently to tailor it for the future.",onUpdate:()=>{},isEditable:!1}),(0,s.jsxs)(m.ZP,{onClick:V,type:"dashed",style:{minWidth:"23%",padding:"1.2em",paddingBottom:"1.2em",margin:"1em",marginBottom:"0.5em",marginTop:"0.5em",height:"auto"},children:[(0,s.jsx)(Z.Z,{style:{fontSize:"20px",marginRight:"8px"}}),"Add Recommendations to Glossary"]}),B&&(0,s.jsxs)("p",{style:{paddingLeft:"1em",marginTop:"1em"},children:["Instructions have been added to ","",(0,s.jsx)("span",{style:{cursor:"pointer",color:"#1890ff",textDecoration:"underline",fontWeight:"bold"},onClick:()=>h.push("/align-model"),children:"glossary"})," ","successfully."]})]})]})]})})};var N=a(92233);let A=()=>{let e="Demo".split(","),[t,a]=(0,n.useState)(null),[h,m]=(0,n.useState)(),[g,y]=(0,n.useState)([]),[f,x]=(0,n.useState)([]),[j,k]=(0,n.useState)([]),[b,w]=(0,n.useState)(""),[v,S]=(0,n.useState)(""),[C,F]=(0,n.useState)(""),[_,Z]=(0,n.useState)(!1),[T,A]=(0,n.useState)("");(0,n.useEffect)(()=>{let t=localStorage.getItem("defogDbSelected"),s=localStorage.getItem("defogToken");t?a(t):a(e[0]),m(s)},[]),(0,n.useEffect)(()=>{t&&localStorage.setItem("defogDbSelected",t),I(h,t),P()},[h,t]);let I=async(e,t)=>{if(!e)return;let a=await fetch((0,i.Z)("http","get_feedback"),{method:"POST",body:JSON.stringify({token:e,key_name:t}),headers:{"Content-Type":"application/json"}}),s=await a.json();y(s.columns),x(s.data)},E=async(e,t)=>{let a=await fetch((0,i.Z)("http","integration/get_glossary_golden_queries"),{method:"POST",body:JSON.stringify({token:e,key_name:t}),headers:{"Content-Type":"application/json"}}),s=await a.json();return{glossary:s.glossary||"",goldenQueries:s.golden_queries||""}},L=async()=>{if(!h||!t)return;let{glossary:e}=await E(h,t);return e},P=async()=>{if(!h||!t)return;let{goldenQueries:e}=await E(h,t);k(e)},Q=async(e,t,a)=>{w(e),S(t),F(a),Z(!0)};return(0,s.jsxs)("div",{className:"flex justify-center",children:[(0,s.jsx)(o.Z,{}),(0,s.jsxs)(r.Z,{id:"view-feedback",userType:"admin",children:[e.length>1?(0,s.jsx)(l.Z,{type:"flex",height:"100vh",children:(0,s.jsx)(d.Z,{span:24,style:{paddingBottom:"1em"},children:(0,s.jsx)(c.Z,{style:{width:"100%"},onChange:e=>{a(e)},options:e.map(e=>({value:e,key:e,label:e})),value:t})})}):null,(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center flex-col m-3",children:[(0,s.jsxs)("h1",{children:[(0,s.jsx)(N.Z,{style:{fontSize:"3em",color:"#1890ff"}})," "]}),(0,s.jsx)("h1",{className:"text-2xl mt-4",children:"Feedback History"})]}),(0,s.jsx)(l.Z,{className:"flex justify-center mb-4",children:(0,s.jsx)(d.Z,{span:24,children:(0,s.jsx)(u.Z,{placeholder:"Filter rows by text",onChange:e=>{A(e.target.value)},className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200"})})}),(0,s.jsx)(p,{token:h,apiKeyName:t,feedbackColumns:g,feedback:f,filter:T,goldenQueries:j,setGoldenQueries:k,handleNegativeFeedback:Q}),_&&(0,s.jsx)(q,{isModalVisible:_,setIsModalVisible:Z,token:h,apiKeyName:t,question:b,sqlGenerated:v,userFeedback:C,getCurrentGlossary:L})]})]})]})};var I=A},93146:function(e,t){"use strict";let a=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost:33364"),""!==t)?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")};t.Z=a}},function(e){e.O(0,[435,919,412,629,592,13,738,502,774,888,179],function(){return e(e.s=86244)}),_N_E=e.O()}]);