(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{97362:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extract-metadata",function(){return a(16334)}])},31143:function(e,t,a){"use strict";var s=a(28598),l=a(1887),o=a.n(l);t.Z=()=>(0,s.jsxs)(o(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},62429:function(e,t,a){"use strict";var s=a(28598),l=a(82684),o=a(91568),r=a(79869),n=a(34376),i=a(89971),d=a(12691),c=a.n(d);t.Z=e=>{let{id:t,userType:a,children:d}=e,{Content:h,Sider:m}=r.Layout,[u,g]=(0,l.useState)([]),[b,p]=(0,l.useContext)(o._),y=(0,n.useRouter)(),redirect=e=>{"/"===e||e.endsWith(".html")||(e+=".html"),e="/static"+e,y.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),p({user:null,token:null,userType:null}),redirect("/log-in")};return(0,l.useEffect)(()=>{g("admin"==a?[{key:"manage-database",title:"Manage Database",icon:(0,s.jsxs)("a",{onClick:()=>redirect("/extract-metadata"),children:[(0,s.jsx)("p",{className:"mr-2",children:"\uD83D\uDCBE"}),"Manage DB"]})},{key:"manage-users",title:"Manage Users",icon:(0,s.jsxs)("a",{onClick:()=>redirect("/manage-users"),children:[(0,s.jsx)("p",{className:"mr-2",children:"\uD83D\uDD10"}),"Manage Users"]})},{key:"view-notebooks",title:"View your notebook",icon:(0,s.jsxs)("a",{onClick:()=>redirect("/view-notebooks"),children:[(0,s.jsx)("p",{className:"mr-2",children:"\uD83D\uDCD2"}),"Your Notebooks"]})},{key:"manage-tools",title:"Manage tools",icon:(0,s.jsxs)("a",{onClick:()=>redirect("/manage-tools"),children:[(0,s.jsx)("p",{className:"mr-2",children:(0,s.jsx)(i.pyo,{})}),"Manage tools"]})},{key:"check-readiness",title:"Check Readiness",icon:(0,s.jsx)("a",{onClick:()=>redirect("/check-readiness"),children:(0,s.jsx)("p",{className:"mr-2",children:"✅ Check Readiness"})})},{key:"align-model",title:"Align Model",icon:(0,s.jsx)("a",{onClick:()=>redirect("/align-model"),children:(0,s.jsx)("p",{className:"mr-2",children:"⚙️ Align Model"})})},{key:"query-data",title:"Query Data",icon:(0,s.jsx)("a",{onClick:()=>redirect("/query-data"),children:(0,s.jsx)("p",{className:"mr-2",children:"\uD83D\uDD0D Query Data"})})},{key:"logout",title:"Logout",icon:(0,s.jsxs)("a",{onClick:logout,children:[(0,s.jsx)("p",{className:"mr-2",children:"↪"})," Logout"]})}]:a?[{key:"view-notebooks",title:"View your notebook",icon:(0,s.jsx)("a",{onClick:()=>redirect("/view-notebooks"),children:"Your Notebooks"})},{key:"query-data",title:"Query Data",icon:(0,s.jsx)(c(),{href:"/query-data",children:"\uD83D\uDD0D Query Data"})},{key:"logout",title:"Logout",icon:(0,s.jsx)("a",{onClick:()=>redirect("/manage-tools"),children:"Logout"})}]:[])},[a]),(0,s.jsx)(r.Layout,{style:{height:"100vh"},children:(0,s.jsxs)(h,{children:[u.length?(0,s.jsx)(m,{style:{height:"100vh",position:"fixed"},children:(0,s.jsx)(r.v2,{style:{width:200,paddingTop:"2em",paddingBottom:"2em"},mode:"inline",selectedKeys:[t],items:u})}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{style:{paddingLeft:240,paddingTop:30,backgroundColor:"#f5f5f5"},children:d})]})})}},16334:function(e,t,a){"use strict";a.r(t);var s=a(28598),l=a(82684),o=a(31143),r=a(62429),n=a(79869),i=a(79204),d=a(71838),c=a(94778);t.default=()=>{let{Option:e}=n.Select,[t,a]=(0,l.useState)("postgres"),[h,m]=(0,l.useState)({}),[u,g]=(0,l.useState)(!1),[b,p]=(0,l.useState)([]),[y,x]=(0,l.useState)(!1),[j,f]=(0,l.useState)([]),[w,k]=(0,l.useState)([]),[v,_]=(0,l.useState)([]),[N,D]=(0,l.useState)(""),[S]=n.l0.useForm(),[C,T]=(0,l.useState)("NO"),getTables=async()=>{let e=localStorage.getItem("defogUser"),t=localStorage.getItem("defogToken");D(t);let s=localStorage.getItem("defogUserType");if(!e||!t||!s){router.push("/log-in");return}let l=await fetch((0,i.Z)("http","integration/get_tables_db_creds"),{method:"POST",body:JSON.stringify({token:t})}),o=await l.json();o.error||(a(o.db_type),m(o.db_creds),p(o.tables),k(o.selected_tables),S.setFieldsValue({db_type:o.db_type,...o.db_creds,db_tables:o.selected_tables}))},getMetadata=async()=>{let e=localStorage.getItem("defogToken");D(e);let t=await fetch((0,i.Z)("http","integration/get_metadata"),{method:"POST",body:JSON.stringify({token:e})}),a=await t.json();a.error||f((null==a?void 0:a.metadata)||[])};(0,l.useEffect)(()=>{x(!0),T("YES"),getTables().then(()=>{getMetadata().then(()=>{x(!1)})})},[]);let I={postgres:["host","port","user","password","database"],redshift:["host","port","user","password","database","schema"],snowflake:["account","warehouse","user","password"],databricks:["server_hostname","access_token","http_path","schema"],bigquery:[]};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{}),(0,s.jsx)(r.Z,{id:"manage-database",userType:"admin",children:(0,s.jsxs)("div",{className:"w-10/12",children:[(0,s.jsxs)("div",{className:"pb-4 flex flex-row items-center mb-5",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Extract Metadata"}),(0,s.jsx)(n.rs,{className:"ml-4",checkedChildren:"Production",unCheckedChildren:"Development",checked:!u,onChange:e=>{console.log(e),g(!e),f([])}})]}),(0,s.jsx)(c.default,{rootClassName:"manage-database-tabs",items:[{key:"db_creds",label:"Database Credentials",children:(0,s.jsx)("div",{className:"w-4/12 mb-10",children:(0,s.jsxs)(n.l0,{name:"db_creds",className:"",form:S,disabled:y,onFinish:async e=>{x(!0),e={db_creds:e,db_type:e.db_type||t,token:N};try{let t=await fetch((0,i.Z)("http","integration/update_db_creds"),{method:"POST",body:JSON.stringify(e)});await t.json(),x(!1),n.yw.success("Database Credentials updated successfully!"),await getTables()}catch(e){console.log(e),x(!1),n.yw.error("Error fetching tables. Please check your docker logs for more informati)on.")}},children:[(0,s.jsx)(n.l0.Item,{name:"db_type",label:"DB Type",children:(0,s.jsx)(n.Select,{style:{width:"100%"},onChange:e=>{a(e),"bigquery"===e&&document.getElementById("update-db-creds-btn").click()},options:["databricks","postgres","redshift","snowflake","bigquery"].map(e=>({value:e,key:e,label:e}))})}),void 0!==I[t]&&I[t].map(e=>"password"!==e?(0,s.jsx)(n.l0.Item,{label:e,name:e,children:(0,s.jsx)(n.II,{style:{width:"100%"}})},t+"_"+e):(0,s.jsx)(n.l0.Item,{label:e,name:e,children:(0,s.jsx)(n.II.Password,{style:{width:"100%"}})},t+"_"+e)),(0,s.jsx)(n.l0.Item,{children:(0,s.jsx)(n.zx,{className:"bg-white border border-gray-300 text-blue-500 hover:bg-blue-500 hover:text-white",type:"primary",style:{width:"100%"},htmlType:"submit",id:"update-db-creds-btn",children:"Update DB Credentials"})})]})})},{key:"db_tables",label:"Extracted metadata",children:(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)(n.l0,{name:"db_tables",disabled:y,onFinish:async e=>{x(!0);try{n.yw.info("Extracting metadata from selected tables. This can take up to 5 minutes. Please be patient.");let t=await fetch((0,i.Z)("http","integration/generate_metadata"),{method:"POST",body:JSON.stringify({tables:e.tables,token:N,dev:u})}),a=await t.json();x(!1),f((null==a?void 0:a.metadata)||[])}catch(e){console.log(e),x(!1),n.yw.error("Error fetching metadata - please look at your docker logs fo)r more information.")}},children:(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("div",{className:"w-4/12 mr-8",children:(0,s.jsx)(n.l0.Item,{name:"tables",label:"Select tables",value:w,children:(0,s.jsx)(n.Select,{mode:"tags",placeholder:"Add tables to index",onChange:e=>{console.log(e),k(e)},children:b.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})})}),(0,s.jsx)("div",{className:"w-2/12",children:(0,s.jsx)(n.zx,{className:"bg-white border border-gray-300 text-blue-500 hover:bg-blue-500 hover:text-white",type:"primary",style:{width:"100%",maxWidth:535},htmlType:"submit",children:"Index tables"})})]})}),(0,s.jsxs)("div",{className:"my-10",children:[j.length>0?(0,s.jsxs)("div",{className:"mt-4 sticky top-0 py-4 z-50 shadow-md bg-white grid grid-cols-4 gap-4 font-bold",children:[(0,s.jsxs)("div",{className:"border-r-2 p-2",children:["Table Name",(0,s.jsx)("div",{className:"table-filter",children:(0,s.jsx)(n.Select,{mode:"tags",className:"m-0 mt-4 w-full font-normal",placeholder:"Filter",onChange:e=>{_(e)},children:b.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})})]}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:"Column Name"}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:"Data Type"}),(0,s.jsx)("div",{className:"p-2",children:"Description (Optional)"})]}):null,j.length>0&&j.map((e,t)=>v.length>0&&!v.includes(e.table_name)?null:(0,s.jsxs)("div",{className:"py-4 grid grid-cols-4 gap-4 "+(t%2==1?"bg-gray-200":""),children:[(0,s.jsx)("div",{className:"p-2 border-r-2",children:e.table_name}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:e.column_name}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:e.data_type}),(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)(n.II.TextArea,{placeholder:"Description of what this column does",defaultValue:e.column_description||"",autoSize:{minRows:2},onChange:e=>{let a=[...j];a[t].column_description=e.target.value,f(a)}},t)})]},e.table_name+"_"+e.column_name)),j.length>0&&(0,s.jsx)(d.default,{rootClassName:"w-96 *:rounded-md bg-orange-500 update-metadata-float",type:"primary",description:"Update Metadata on servers",className:"mt-5 ",disabled:y,loading:y,onClick:async()=>{x(!0);let e=await fetch((0,i.Z)("http","integration/update_metadata"),{method:"POST",body:JSON.stringify({metadata:j,token:N,dev:u})}),t=await e.json();x(!1),void 0!==t.suggested_joins&&null!==t.suggested_joins&&""!==t.suggested_joins&&(document.getElementById("allowed-joins").value=t.suggested_joins),n.yw.success("Metadata updated successfully!")}})]})]})}]})]})})]})}},79204:function(e,t){"use strict";t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==t?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")}}},function(e){e.O(0,[665,958,664,774,888,179],function(){return e(e.s=97362)}),_N_E=e.O()}]);