(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{97362:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/extract-metadata",function(){return a(16334)}])},26335:function(e,t,a){"use strict";var s=a(28598),l=a(1887),n=a.n(l);t.Z=()=>(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,t,a){"use strict";var s=a(28598),l=a(82684),n=a(97574),r=a(79869),o=a(34376);a(12691);var i=a(26978),d=a(47663),h=a(56572);t.Z=e=>{let{id:t,userType:a,children:c,rootClassNames:m="",contentClassNames:u=""}=e,{Content:b,Sider:g}=r.Layout,[f,p]=(0,l.useState)([]),[y,w]=(0,l.useContext)(n.S),_=(0,o.useRouter)(),redirect=e=>{_.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),w({user:null,token:null,userType:null}),redirect("/static/log-in.html")},x=(0,d.usePathname)();(0,l.useEffect)(()=>{p(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==x,e)))},[a]);let[v,j]=(0,l.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,l.useEffect)(()=>{"/query-data"===x&&j("flex flex-col md:min-h-screen relative")},[x]),(0,s.jsxs)("div",{className:(0,h.m6)(v,m),children:[f.length?(0,s.jsx)(i.l2,{rootClassNames:"border-b",items:f}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:(0,h.m6)("grow",u),children:c})]})}},16334:function(e,t,a){"use strict";a.r(t);var s=a(28598),l=a(82684),n=a(26335),r=a(79869),o=a(79204),i=a(71838),d=a(94778),h=a(82067),c=a(34376);t.default=()=>{let{Option:e}=r.Select,[t,a]=(0,l.useState)("postgres"),[m,u]=(0,l.useState)({}),[b,g]=(0,l.useState)(!1),[f,p]=(0,l.useState)([]),[y,w]=(0,l.useState)(!1),[_,x]=(0,l.useState)([]),[v,j]=(0,l.useState)([]),[k,N]=(0,l.useState)([]),[S,T]=(0,l.useState)(""),[C]=r.l0.useForm(),[I,E]=(0,l.useState)("NO"),P="Defog".split(","),[D,O]=(0,l.useState)(P[0]),z=(0,c.useRouter)(),getTables=async()=>{let e=localStorage.getItem("defogUser"),t=localStorage.getItem("defogToken");T(t);let s=localStorage.getItem("defogUserType");if(!e||!t||!s){z.push("/log-in");return}let l=await fetch((0,o.Z)("http","integration/get_tables_db_creds"),{method:"POST",body:JSON.stringify({token:t,key_name:D})});if(401===l.status){r.yw.error("Your credentials are incorrect. Please log in again.");return}let n=await l.json();n.error?(u({}),p([]),j([]),C.setFieldsValue({db_type:"",db_tables:[],host:"",port:"",user:"",password:"",database:"",schema:"",account:"",warehouse:"",access_token:"",server_hostname:"",http_path:""})):(a(n.db_type),u(n.db_creds),p(n.tables),j(n.selected_tables),C.setFieldsValue({db_type:n.db_type,...n.db_creds,db_tables:n.selected_tables}))},q={inning:"the inning number",batting_team:"name of the batting team",bowling_team:"name of the bowling team",batsman:"the player id of the batsman",bowler:"the player id of the bowler",batsman_name:"name of the batsman",non_striker:"name of the non-striker",bowler_name:"name of the bowler",bat_right_handed:"indicates whether the player is left or right handed",ovr:"the over number as a float. 2.4 would mean this was the 4th ball of the 3rd over. 0.1 would mean this was the first ball of the first",runs_batter:"the number of runs scored by the batsman on this ball",runs_w_extras:"the number of runs scored on this ball including extras",extras:"the number of extras scored on this ball",x:"x coordinate of where the ball ended up after it was hit. is 0 when it reaches the left-most region of the ground (the point boundary for a right hander) and is 360 when it reaches the right-most region of the ground (the point boundary for a right hander)",y:"y coordinate of where the ball ended up after it was hit. 'y' is 0 when the ball reaches the boundary straight down the ground (i.e., after a perfect straight drive), and is 360 when it reaches the boundary after going over the keeper's head",z:"the zone in which a ball was hit. z=1 is the fine-leg zone, z=2 is the zone behind square leg, z=3 is the zone in front of square leg etc. This progress all the way until z=8, which is the third-man area",landing_x:"the distance (in meters) away from the centre of the pitch that the ball lands. A negative value indicates the ball landed outside off-stump for a right-hander and outside leg-stump for a left-hander",landing_y:"the distance (in meters) away from the batsman stumps that a ball lands. A negative value indicates a full toss.",ended_x:"the distance (in meters) away from the centre of the pitch that the ball ends up when it reaches the batsman. A negative value indicates the ball landed outside off-stump for a right-hander and outside leg-stump for a left-hander.",ended_y:"the height (in meters) above the pitch by the time it reaches the batsman.",ball_speed:"the speed of the ball in miles per hour",cumul_runs:"the total number of runs scored by the batting team up to this point",wicket:"whether or not a wicket fell on this ball",wicket_method:"the method by which the wicket fell",who_out:"the name of the player who was out",control:"whether or not the batsman middled the ball (1=middled, 0=not middled)",extras_type:"the type of extras scored on this ball",match_id:"the id of the match",team1_name:"the name of the first team",team2_name:"the name of the second team",team1_id:"the id of the first team",team2_id:"the id of the second team",ground_name:"the name of the ground",ground_id:"the id of the ground",date:"the date of the match"},getMetadata=async()=>{let e=localStorage.getItem("defogToken");T(e);let t=await fetch((0,o.Z)("http","integration/get_metadata"),{method:"POST",body:JSON.stringify({token:e,key_name:D})});if(401===t.status){r.yw.error("Your credentials are incorrect. Please log in again.");return}let a=await t.json();a.error||x((null==a?void 0:a.metadata)||[])};(0,l.useEffect)(()=>{w(!0),E("YES"),getTables().then(()=>{getMetadata().then(()=>{w(!1)})})},[D]);let A={postgres:["host","port","user","password","database"],redshift:["host","port","user","password","database","schema"],snowflake:["account","warehouse","user","password"],databricks:["server_hostname","access_token","http_path","schema"],bigquery:[]};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{}),(0,s.jsx)(h.Z,{id:"manage-database",userType:"admin",children:(0,s.jsxs)("div",{className:"w-10/12",children:[P.length>1?(0,s.jsx)(r.X2,{type:"flex",height:"100vh",children:(0,s.jsx)(r.JX,{span:24,style:{paddingBottom:"1em"},children:(0,s.jsx)(r.Select,{style:{width:"100%"},onChange:e=>{O(e)},options:P.map(e=>({value:e,key:e,label:e})),defaultValue:D})})}):null,(0,s.jsxs)("div",{className:"pb-4 flex flex-row items-center mb-5",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Extract Metadata"}),(0,s.jsx)(r.rs,{className:"ml-4",checkedChildren:"Production",unCheckedChildren:"Development",checked:!b,onChange:e=>{console.log(e),g(!e),x([])}})]}),(0,s.jsx)(d.default,{rootClassName:"manage-database-tabs",items:[{key:"db_creds",label:"Database Credentials",children:(0,s.jsx)("div",{className:"w-4/12 mb-10",children:(0,s.jsxs)(r.l0,{name:"db_creds",className:"",form:C,disabled:y,onFinish:async e=>{w(!0),e={db_creds:e,db_type:e.db_type||t,token:S,key_name:D};try{let t=await fetch((0,o.Z)("http","integration/update_db_creds"),{method:"POST",body:JSON.stringify(e)});await t.json(),w(!1),r.yw.success("Database Credentials updated successfully!"),await getTables()}catch(e){console.log(e),w(!1),r.yw.error("Error fetching tables. Please check your docker logs for more informati)on.")}},children:[(0,s.jsx)(r.l0.Item,{name:"db_type",label:"DB Type",children:(0,s.jsx)(r.Select,{style:{width:"100%"},onChange:e=>{a(e),"bigquery"===e&&document.getElementById("update-db-creds-btn").click()},options:["databricks","postgres","redshift","snowflake","bigquery"].map(e=>({value:e,key:e,label:e}))})}),void 0!==A[t]&&A[t].map(e=>"password"!==e?(0,s.jsx)(r.l0.Item,{label:e,name:e,children:(0,s.jsx)(r.II,{style:{width:"100%"}})},t+"_"+e):(0,s.jsx)(r.l0.Item,{label:e,name:e,children:(0,s.jsx)(r.II.Password,{style:{width:"100%"}})},t+"_"+e)),(0,s.jsx)(r.l0.Item,{children:(0,s.jsx)(r.zx,{className:"bg-white border border-gray-300 text-blue-500 hover:bg-blue-500 hover:text-white",type:"primary",style:{width:"100%"},htmlType:"submit",id:"update-db-creds-btn",children:"Update DB Credentials"})})]})})},{key:"db_tables",label:"Extracted metadata",children:(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)(r.l0,{name:"db_tables",disabled:y,onFinish:async e=>{w(!0);try{r.yw.info("Extracting metadata from selected tables. This can take up to 5 minutes. Please be patient.");let t=await fetch((0,o.Z)("http","integration/generate_metadata"),{method:"POST",body:JSON.stringify({tables:e.tables,token:S,dev:b,key_name:D})}),a=await t.json();w(!1),a.metadata.forEach(e=>{q[e.column_name]&&(e.column_description=q[e.column_name])}),x((null==a?void 0:a.metadata)||[])}catch(e){console.log(e),w(!1),r.yw.error("Error fetching metadata - please look at your docker logs for more information.")}},children:(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("div",{className:"w-4/12 mr-8",children:(0,s.jsx)(r.l0.Item,{name:"tables",label:"Select tables",value:v,children:(0,s.jsx)(r.Select,{mode:"tags",placeholder:"Add tables to index",onChange:e=>{console.log(e),j(e)},children:f.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})})}),(0,s.jsx)("div",{className:"w-2/12",children:(0,s.jsx)(r.zx,{className:"bg-white border border-gray-300 text-blue-500 hover:bg-blue-500 hover:text-white",type:"primary",style:{width:"100%",maxWidth:535},htmlType:"submit",children:"Index tables"})})]})}),(0,s.jsxs)("div",{className:"my-10",children:[_.length>0?(0,s.jsxs)("div",{className:"header mt-4 sticky top-0 py-4 z-50 shadow-md bg-white grid grid-cols-4 gap-4 font-bold",children:[(0,s.jsxs)("div",{className:"border-r-2 p-2",children:["Table Name",(0,s.jsx)("div",{className:"table-filter",children:(0,s.jsx)(r.Select,{mode:"tags",className:"m-0 mt-4 w-full font-normal",placeholder:"Filter",onChange:e=>{N(e)},children:f.map(t=>(0,s.jsx)(e,{value:t,children:t},t))})})]}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:"Column Name"}),(0,s.jsx)("div",{className:"p-2 border-r-2",children:"Data Type"}),(0,s.jsx)("div",{className:"p-2",children:"Description (Optional)"})]}):null,_.length>0&&_.map((e,t)=>k.length>0&&!k.includes(e.table_name)?null:(0,s.jsxs)("div",{className:"py-4 grid grid-cols-4 gap-4 "+(t%2==1?"bg-gray-200":""),children:[(0,s.jsx)("div",{className:"table_name p-2 border-r-2",children:e.table_name}),(0,s.jsx)("div",{className:"column_name p-2 border-r-2",children:e.column_name}),(0,s.jsx)("div",{className:"data_type p-2 border-r-2",children:e.data_type}),(0,s.jsx)("div",{className:"column_description p-2",children:(0,s.jsx)(r.II.TextArea,{placeholder:"Description of what this column does",defaultValue:e.column_description||"",autoSize:{minRows:2},onChange:e=>{let a=[..._];a[t].column_description=e.target.value,x(a)}},t)})]},e.table_name+"_"+e.column_name)),_.length>0&&(0,s.jsx)(i.default,{rootClassName:"w-96 *:rounded-md bg-orange-500 update-metadata-float",type:"primary",description:"Update Metadata on servers",className:"mt-5 ",disabled:y,loading:y,onClick:async()=>{w(!0);let e=await fetch((0,o.Z)("http","integration/update_metadata"),{method:"POST",body:JSON.stringify({metadata:_,token:S,dev:b,key_name:D})}),t=await e.json();w(!1),void 0!==t.suggested_joins&&null!==t.suggested_joins&&""!==t.suggested_joins&&(document.getElementById("allowed-joins").value=t.suggested_joins),r.yw.success("Metadata updated successfully!")}})]})]})}]})]})})]})}},79204:function(e,t){"use strict";t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost:33364"),""!==t)?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")}}},function(e){e.O(0,[435,774,888,179],function(){return e(e.s=97362)}),_N_E=e.O()}]);