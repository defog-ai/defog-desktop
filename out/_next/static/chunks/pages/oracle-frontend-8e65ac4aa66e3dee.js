(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{35334:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"}},62573:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"}},13966:function(e,t,a){"use strict";var s=a(79290).default,l=a(44512).default;t.Z=void 0;var r=l(a(17963)),o=s(a(82684)),n=l(a(35334)),i=l(a(32905)),c=o.forwardRef(function(e,t){return o.createElement(i.default,(0,r.default)({},e,{ref:t,icon:n.default}))});t.Z=c},55658:function(e,t,a){"use strict";var s=a(79290).default,l=a(44512).default;t.Z=void 0;var r=l(a(17963)),o=s(a(82684)),n=l(a(62573)),i=l(a(32905)),c=o.forwardRef(function(e,t){return o.createElement(i.default,(0,r.default)({},e,{ref:t,icon:n.default}))});t.Z=c},41599:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/oracle-frontend",function(){return a(29188)}])},26335:function(e,t,a){"use strict";var s=a(28598),l=a(1887),r=a.n(l);t.Z=()=>(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,t,a){"use strict";var s=a(28598),l=a(82684),r=a(97574),o=a(79869),n=a(34376);a(12691);var i=a(26978),c=a(47663),d=a(56572);t.Z=e=>{let{id:t,userType:a,children:u,rootClassNames:h="",contentClassNames:f=""}=e,{Content:m,Sider:p}=o.Layout,[g,x]=(0,l.useState)([]),[y,v]=(0,l.useContext)(r.S),N=(0,n.useRouter)(),redirect=e=>{N.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),v({user:null,token:null,userType:null}),redirect("/static/log-in.html")},k=(0,c.usePathname)();(0,l.useEffect)(()=>{x(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==k,e)))},[a]);let[j,_]=(0,l.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,l.useEffect)(()=>{("/query-data"===k||"/static/query-data.html"===k)&&_("flex flex-col md:min-h-screen relative")},[k]),(0,s.jsxs)("div",{className:(0,d.m6)(j,h),children:[g.length?(0,s.jsx)(i.l2,{rootClassNames:"border-b",items:g}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:(0,d.m6)("grow",f),children:u})]})}},29188:function(e,t,a){"use strict";a.r(t);var s=a(28598),l=a(20259),r=a.n(l),o=a(33612),n=a(37490),i=a(92696),c=a(24788),d=a(49603),u=a(82684),h=a(26335),f=a(82067),m=a(79204),p=a(13966),g=a(55658),x=a(82098),y=a(48497);t.default=function(){let e=(y.env.NEXT_PUBLIC_API_KEY_NAMES||"REPLACE_WITH_API_KEY_NAMES").split(","),[t,a]=(0,u.useState)(e[0]),[l,v]=(0,u.useState)(""),[N,k]=(0,u.useState)([]),[j,_]=(0,u.useState)(!1),[b,w]=(0,u.useState)(!1),[T,S]=(0,u.useState)([]),getClarifications=async()=>{if(l.length<5){console.log("User task is too short, not fetching clarifications yet");return}_(!0);let e=localStorage.getItem("defogToken"),a=await fetch((0,m.Z)("http","oracle/clarify_formulation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t,question:l})});if(_(!1),a.ok){let e=await a.json();k(e.clarifications),w(e.ready)}else console.error("Failed to fetch clarifications")},deleteClarification=e=>{k(t=>t.filter((t,a)=>a!==e))},checkAllFinished=e=>e.every(e=>"done"===e.status||"error"===e.status),getReports=async()=>{let e=localStorage.getItem("defogToken"),pollReports=async()=>{try{let s=await fetch((0,m.Z)("http","oracle/list_reports"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t})});if(s.ok){let e=await s.json();S(e.reports),checkAllFinished(e.reports)&&clearInterval(a)}else console.error("Failed to fetch reports"),clearInterval(a)}catch(e){console.error("An error occurred:",e),clearInterval(a)}},a=setInterval(pollReports,1e3);pollReports()},deleteReport=async e=>{let a=localStorage.getItem("defogToken"),s=await fetch((0,m.Z)("http","oracle/delete_report"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:a,key_name:t,report_id:T[e].report_id})});s.ok&&getReports()},generateReport=async()=>{let e=localStorage.getItem("defogToken"),a=await fetch((0,m.Z)("http","oracle/begin_generation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,key_name:t,question:l})});a.ok&&getReports()};return(0,u.useEffect)(()=>{let e=setTimeout(()=>{getClarifications()},3e3);return()=>clearTimeout(e)},[l]),(0,u.useEffect)(()=>{getReports()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{}),(0,s.jsxs)(f.Z,{id:"align-model",userType:"admin",children:[e.length>1?(0,s.jsx)(n.default,{type:"flex",height:"100vh",children:(0,s.jsx)(i.default,{span:24,style:{paddingBottom:"1em"},children:(0,s.jsx)(c.default,{style:{width:"100%"},onChange:e=>{a(e)},options:e.map(e=>({value:e,key:e,label:e})),defaultValue:t})})}):null,(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"The Oracle"}),(0,s.jsx)("p",{className:"text-gray-600",children:"The Oracle is a background assistant, helping you to dig into your dataset for insights. To begin, please let us know what you are interested in below."})]}),(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)(o.default.TextArea,{placeholder:"Describe what you would like the Oracle to do...",className:"w-full p-3 border rounded-lg text-gray-700 focus:outline-none focus:border-purple-500",value:l,onChange:e=>{v(e.target.value)},autoSize:{minRows:2,maxRows:10},style:{flexBasis:"90%"}}),(0,s.jsx)("div",{className:"ml-2",children:j?(0,s.jsx)(d.default,{}):l&&(b?(0,s.jsx)(p.Z,{style:{color:"green"}}):(0,s.jsx)(g.Z,{style:{color:"#808080"}}))})]}),N.length>0&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Clarifications"}),N.map((e,t)=>(0,s.jsxs)("div",{className:"bg-amber-100 p-4 rounded-lg mb-4 relative",children:[(0,s.jsx)("p",{className:"text-amber-500",children:e}),(0,s.jsx)(x.default,{className:"text-amber-500 absolute top-2 right-2 cursor-pointer",onClick:()=>deleteClarification(t)})]},t))]}),(0,s.jsx)(r(),{className:"bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600",disabled:!b,onClick:generateReport,children:"Generate"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Past Reports"}),T.map((e,t)=>(0,s.jsxs)("div",{className:"bg-purple-100 p-4 rounded-lg mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:e.report_id}),(0,s.jsx)("p",{className:"text-purple-700",children:e.report_name}),(0,s.jsx)("p",{className:"text-gray-600",children:e.status}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Generated at ",e.date_created]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{className:"text-purple-700 hover:text-purple-900",children:"Download"}),(0,s.jsx)("button",{className:"text-purple-700 hover:text-purple-900",onClick:()=>deleteReport(t),children:"Delete"})]})]},t))]})]})]})}},79204:function(e,t,a){"use strict";var s=a(48497);t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT),""!==t)?"ws"===e?"".concat((s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(t):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(t):"".concat(s.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},function(e){e.O(0,[435,774,888,179],function(){return e(e.s=41599)}),_N_E=e.O()}]);