(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{4139:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return a(42604)}])},26335:function(e,s,a){"use strict";var t=a(28598),r=a(1887),n=a.n(r);s.Z=()=>(0,t.jsxs)(n(),{children:[(0,t.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,t.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,s,a){"use strict";var t=a(28598),r=a(82684),n=a(97574),l=a(79869),o=a(34376);a(12691);var d=a(26978),i=a(47663),u=a(56572);s.Z=e=>{let{id:s,userType:a,children:c,rootClassNames:m="",contentClassNames:h=""}=e,{Content:f,Sider:p}=l.Layout,[g,y]=(0,r.useState)([]),[x,w]=(0,r.useContext)(n.S),j=(0,o.useRouter)(),redirect=e=>{j.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),w({user:null,token:null,userType:null}),redirect("/static/log-in.html")},T=(0,i.usePathname)();(0,r.useEffect)(()=>{y(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==T,e)))},[a]);let[_,N]=(0,r.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,r.useEffect)(()=>{"/query-data"===T&&N("flex flex-col md:min-h-screen relative")},[T]),(0,t.jsxs)("div",{className:(0,u.m6)(_,m),children:[g.length?(0,t.jsx)(d.l2,{rootClassNames:"border-b",items:g}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)("div",{className:(0,u.m6)("grow",h),children:c})]})}},42604:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return manage_users}});var t=a(28598),r=a(82684),n=a(34376),l=a(26335),o=a(82067),d=a(97574),i=a(79204),u=a(85439),c=a(33612),m=a(20259),h=a.n(m),f=a(18953),p=a(89153),g=a(35371),y=a(55964),x=a(7077),w=a(28718),j=a.n(w);let{Title:T}=g.default;var manage_users_AddUsersViaFile=e=>{let{loading:s,context:a,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[d,m]=(0,r.useState)("username,password,user_type\n"),[g,w]=(0,r.useState)(""),[_,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");m("username,password,user_type\n".concat(e))},[l]),(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");m("username,password,user_type\n".concat(e))},[l]);let handleSubmit=async e=>{try{let s="username,password,user_type"!==d.trim()?"admin/add_users_csv":"admin/add_users",t="username,password,user_type"!==d.trim()?{users_csv:d,token:a.token}:{...e,token:a.token},r=await fetch((0,i.Z)("http",s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let l=await r.json();if("success"===l.status)f.default.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}]);else throw Error(l.message||"There was an error adding the users.");await n()}catch(e){console.error("Error:",e),f.default.error(e.message||"There was an error adding the users. Please try again.")}finally{N(!1),m("username,password,user_type\n")}};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,t.jsx)(y.Z,{className:"mr-2"}),"Add Users via File"]}),(0,t.jsxs)(u.default,{layout:"vertical",disabled:s,onFinish:handleSubmit,children:[(0,t.jsx)(T,{level:4,children:"Option 1: Paste Google Sheets URL"}),(0,t.jsx)(u.default.Item,{label:"Google Sheets URL",name:"gsheets_url",children:(0,t.jsx)(c.default,{className:"pd-2",value:g,onChange:e=>w(e.target.value)})}),(0,t.jsx)(T,{level:4,className:"mt-6",children:"Option 2: Upload CSV File"}),(0,t.jsx)(u.default.Item,{label:_?"":"Expected columns in the file: username,password,user_type",children:(0,t.jsx)(p.default,{beforeUpload:e=>(j().parse(e,{error:e=>{f.default.error("There was an error parsing the CSV file.")},complete:e=>{let s=e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}));o(s),N(!0),w(""),f.default.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),accept:".csv",showUploadList:!1,disabled:_,children:(0,t.jsx)(h(),{icon:(0,t.jsx)(x.Z,{}),disabled:_,children:_?"Uploaded":"Upload CSV"})})}),_&&(0,t.jsx)(u.default.Item,{label:"Generated CSV String",className:"mt-4",children:(0,t.jsx)(c.default.TextArea,{value:d,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,t.jsx)(u.default.Item,{children:(0,t.jsx)(h(),{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block",disabled:"username,password,user_type"===d.trim()&&!g,children:"Add Users"})})]})]})},_=a(24788),N=a(5582);let{Option:b}=_.default;var manage_users_AddUsersViaForm=e=>{let{loading:s,context:a,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[d,m]=(0,r.useState)("username,password,user_type\n");(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");m("username,password,user_type\n".concat(e))},[l]);let handleChange=(e,s,a)=>{let t=[...l];t[e][s]=a,o(t)},handleSubmit=async()=>{let e=await fetch((0,i.Z)("http","admin/add_users_csv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:d,token:a.token})}),s=await e.json();"success"===s.status?(f.default.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}])):f.default.error("There was an error adding the users. Please try again."),await n()};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,t.jsx)(N.Z,{className:"mr-2"}),"Add Users Manually"]}),(0,t.jsxs)(u.default,{layout:"vertical",disabled:s,onFinish:handleSubmit,className:"w-full",children:[l.map((e,s)=>(0,t.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,t.jsx)(u.default.Item,{label:"Username",name:"username".concat(s),required:!0,className:"w-1/3",children:(0,t.jsx)(c.default,{className:"border border-gray-200 h-9 rounded-md",value:e.username,onChange:e=>handleChange(s,"username",e.target.value)})}),(0,t.jsx)(u.default.Item,{label:"Password",name:"password".concat(s),required:!0,className:"w-1/3",children:(0,t.jsx)(c.default.Password,{className:"h-9",value:e.password,onChange:e=>handleChange(s,"password",e.target.value)})}),(0,t.jsx)(u.default.Item,{label:"User Type",name:"userType".concat(s),required:!0,className:"w-1/3",children:(0,t.jsxs)(_.default,{value:e.userType,onChange:e=>handleChange(s,"userType",e),className:"h-9",children:[(0,t.jsx)(b,{value:"admin",children:"Admin"}),(0,t.jsx)(b,{value:"general",children:"General"})]})})]},s)),(0,t.jsx)(h(),{type:"dashed",onClick:()=>o([...l,{username:"",password:"",userType:""}]),block:!0,children:"Add Another User"}),"username,password,user_type"!==d.trim()&&(0,t.jsx)(u.default.Item,{label:"Generated CSV String",className:"mt-4",children:(0,t.jsx)(c.default.TextArea,{value:d,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,t.jsx)(u.default.Item,{children:(0,t.jsx)(h(),{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block mt-20",disabled:"username,password,user_type"===d.trim(),children:"Add Users"})})]})]})},v=a(10998),k=a(35575),S=a(22399),U=a(49603),C=a(31585),manage_users_UsersTable=e=>{let{userDets:s,context:a,getUserDets:r,loading:n,setLoading:l}=e,showDeleteConfirm=e=>{S.default.confirm({title:"Are you sure you want to delete this user?",content:"User: ".concat(e),okText:"Yes",okType:"danger",cancelText:"No",className:"w-1/3",onOk:async()=>{l(!0);let s=await fetch((0,i.Z)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:a.token}),headers:{"Content-Type":"application/json"}}),t=await s.json();"success"===t.status?f.default.success("User deleted successfully! Refreshing the user data..."):f.default.error("There was an error deleting the user. Please try again."),await r(),l(!1)}})};return(0,t.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,t.jsx)(U.default,{spinning:n,tip:"Getting Latest Users Data",children:(0,t.jsx)(v.default,{className:"mt-10 border border-gray-200 rounded-lg shadow-lg bg-gray-100",dataSource:s,columns:[{title:"User ID",dataIndex:"username",key:"username",width:"33%",align:"center"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"33%",align:"center"},{title:"Action",key:"delete_user",width:"33%",align:"center",render:(e,s)=>(0,t.jsx)(k.default,{size:"middle",children:(0,t.jsx)(h(),{type:"default",icon:(0,t.jsx)(C.default,{}),onClick:()=>showDeleteConfirm(s.username)})})}]})})})},E=a(46368),manage_users=()=>{let[e,s]=(0,r.useState)(!1),[a,u]=(0,r.useState)([]),[c,m]=(0,r.useContext)(d.S),h=(0,n.useRouter)(),getUserDets=async()=>{if(s(!0),!c.token)return;let e=await fetch((0,i.Z)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:c.token}),headers:{"Content-Type":"application/json"}}),a=await e.json();a.users?u(a.users):f.default.error("There was an error fetching the user data. Please try again."),s(!1)};return(0,r.useEffect)(()=>{let e=c.token,s=c.userType;if(!s){let a=localStorage.getItem("defogUser");if(e=localStorage.getItem("defogToken"),s=localStorage.getItem("defogUserType"),!a||!e||!s){h.push("/log-in");return}m({user:a,token:e,userType:s})}e?getUserDets():h.push("/log-in")},[c,c.token]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{}),(0,t.jsxs)(o.Z,{id:"manage-users",userType:"admin",children:[(0,t.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,t.jsxs)("h1",{children:[(0,t.jsx)(E.Z,{style:{fontSize:"3.5em",color:"#1890ff"}})," "]}),(0,t.jsx)("h1",{className:"text-3xl mt-4",children:"Manage Users"})]}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,t.jsx)(manage_users_UsersTable,{userDets:a,context:c,getUserDets:getUserDets,loading:e,setLoading:s})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,t.jsx)(manage_users_AddUsersViaFile,{loading:e,context:c,getUserDets:getUserDets})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,t.jsx)(manage_users_AddUsersViaForm,{loading:e,context:c,getUserDets:getUserDets})})]})]})}},79204:function(e,s,a){"use strict";var t=a(48497);s.Z=(e,s)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log(t.env.NEXT_PUBLIC_AGENTS_ENDPOINT),""!==s)?"ws"===e?"".concat((t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"").replace("http","ws"),"/").concat(s):"".concat(t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"","/").concat(s):"".concat(t.env.NEXT_PUBLIC_AGENTS_ENDPOINT||"")}}},function(e){e.O(0,[435,279,774,888,179],function(){return e(e.s=4139)}),_N_E=e.O()}]);