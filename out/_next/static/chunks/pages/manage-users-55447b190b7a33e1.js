(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{4139:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage-users",function(){return a(13957)}])},42449:function(e,s,a){"use strict";var t=a(28598),r=a(1887),n=a.n(r);let l=()=>(0,t.jsxs)(n(),{children:[(0,t.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,t.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]});s.Z=l},22500:function(e,s,a){"use strict";var t=a(28598),r=a(82684),n=a(36189),l=a(79869),o=a(34376);a(12691);var c=a(26978),i=a(47663),d=a(56572);let u=e=>{let{id:s,userType:a,children:u,rootClassNames:m="",contentClassNames:h=""}=e,{Content:p,Sider:y}=l.Ar,[f,g]=(0,r.useState)([]),[x,w]=(0,r.useContext)(n.S),j=(0,o.useRouter)(),k=e=>{j.push(e)},b=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),w({user:null,token:null,userType:null}),k("/log-in")},v=(0,i.usePathname)();(0,r.useEffect)(()=>{g(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/extract-metadata"},{key:"manage-users",title:"Manage Users",href:"/manage-users"},{key:"manage-tools",title:"Manage tools",href:"/manage-tools"},{key:"check-readiness",title:"Check Readiness",href:"/check-readiness"},{key:"align-model",title:"Align Model",href:"/align-model"},{key:"view-feedback",title:"View Feedback",href:"/view-feedback"},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:a?[{key:"view-notebooks",title:"View your notebook",href:"/view-notebooks"},{key:"query-data",title:"Query Data",href:"/query-data"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:[]).map(e=>(e.current=e.href==v,e)))},[a]);let[Z,T]=(0,r.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,r.useEffect)(()=>{"/query-data"===v&&T("flex flex-col md:min-h-screen relative")},[v]),(0,t.jsxs)("div",{className:(0,d.m6)(Z,m),children:[f.length?(0,t.jsx)(c.l2,{rootClassNames:"border-b",items:f}):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)("div",{className:(0,d.m6)("grow",h),children:u})]})};s.Z=u},13957:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return E}});var t=a(28598),r=a(82684),n=a(34376),l=a(42449),o=a(22500),c=a(36189),i=a(93146),d=a(56823),u=a(16496),m=a(46286),h=a(80128),p=a(20673),y=a(4134),f=a(35173),g=a(54213),x=a(28718),w=a.n(x);let{Title:j}=d.Z,k=e=>{let{loading:s,context:a,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[c,d]=(0,r.useState)("username,password,user_type\n"),[x,k]=(0,r.useState)(""),[b,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]),(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]);let Z=e=>(w().parse(e,{error:e=>{u.ZP.error("There was an error parsing the CSV file.")},complete:e=>{let s=e.data.map(e=>({username:e.username,password:e.password,userType:e.user_type}));o(s),v(!0),k(""),u.ZP.success("CSV file parsed successfully. Please hit 'Add Users' to proceed.")},header:!0,skipEmptyLines:!0}),!1),T=async e=>{try{let s="username,password,user_type"!==c.trim()?"admin/add_users_csv":"admin/add_users",t="username,password,user_type"!==c.trim()?{users_csv:c,token:a.token}:{...e,token:a.token},r=await fetch((0,i.Z)("http",s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let l=await r.json();if("success"===l.status)u.ZP.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}]);else throw Error(l.message||"There was an error adding the users.");await n()}catch(m){console.error("Error:",m),u.ZP.error(m.message||"There was an error adding the users. Please try again.")}finally{v(!1),d("username,password,user_type\n")}};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,t.jsx)(f.Z,{className:"mr-2"}),"Add Users via File"]}),(0,t.jsxs)(m.Z,{layout:"vertical",disabled:s,onFinish:T,children:[(0,t.jsx)(j,{level:4,children:"Option 1: Paste Google Sheets URL"}),(0,t.jsx)(m.Z.Item,{label:"Google Sheets URL",name:"gsheets_url",children:(0,t.jsx)(h.Z,{className:"pd-2",value:x,onChange:e=>k(e.target.value)})}),(0,t.jsx)(j,{level:4,className:"mt-6",children:"Option 2: Upload CSV File"}),(0,t.jsx)(m.Z.Item,{label:b?"":"Expected columns in the file: username,password,user_type",children:(0,t.jsx)(p.Z,{beforeUpload:Z,accept:".csv",showUploadList:!1,disabled:b,children:(0,t.jsx)(y.ZP,{icon:(0,t.jsx)(g.Z,{}),disabled:b,children:b?"Uploaded":"Upload CSV"})})}),b&&(0,t.jsx)(m.Z.Item,{label:"Generated CSV String",className:"mt-4",children:(0,t.jsx)(h.Z.TextArea,{value:c,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,t.jsx)(m.Z.Item,{children:(0,t.jsx)(y.ZP,{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block",disabled:"username,password,user_type"===c.trim()&&!x,children:"Add Users"})})]})]})};var b=a(56193),v=a(39813);let{Option:Z}=b.Z,T=e=>{let{loading:s,context:a,getUserDets:n}=e,[l,o]=(0,r.useState)([{username:"",password:"",userType:""}]),[c,d]=(0,r.useState)("username,password,user_type\n");(0,r.useEffect)(()=>{let e=l.filter(e=>e.username&&e.password&&e.userType).map(e=>"".concat(e.username,",").concat(e.password,",").concat(e.userType)).join("\n");d("username,password,user_type\n".concat(e))},[l]);let p=(e,s,a)=>{let t=[...l];t[e][s]=a,o(t)},f=async()=>{let e=await fetch((0,i.Z)("http","admin/add_users_csv"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users_csv:c,token:a.token})}),s=await e.json();"success"===s.status?(u.ZP.success("Users added successfully! Refreshing the user data..."),o([{username:"",password:"",userType:""}])):u.ZP.error("There was an error adding the users. Please try again."),await n()};return(0,t.jsxs)("div",{className:"w-3/4 p-6 border border-gray-200 rounded-lg shadow-lg",children:[(0,t.jsxs)("h1",{className:"text-center text-2xl mb-8",children:[(0,t.jsx)(v.Z,{className:"mr-2"}),"Add Users Manually"]}),(0,t.jsxs)(m.Z,{layout:"vertical",disabled:s,onFinish:f,className:"w-full",children:[l.map((e,s)=>(0,t.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,t.jsx)(m.Z.Item,{label:"Username",name:"username".concat(s),required:!0,className:"w-1/3",children:(0,t.jsx)(h.Z,{className:"border border-gray-200 h-9 rounded-md",value:e.username,onChange:e=>p(s,"username",e.target.value)})}),(0,t.jsx)(m.Z.Item,{label:"Password",name:"password".concat(s),required:!0,className:"w-1/3",children:(0,t.jsx)(h.Z.Password,{className:"h-9",value:e.password,onChange:e=>p(s,"password",e.target.value)})}),(0,t.jsx)(m.Z.Item,{label:"User Type",name:"userType".concat(s),required:!0,className:"w-1/3",children:(0,t.jsxs)(b.Z,{value:e.userType,onChange:e=>p(s,"userType",e),className:"h-9",children:[(0,t.jsx)(Z,{value:"admin",children:"Admin"}),(0,t.jsx)(Z,{value:"general",children:"General"})]})})]},s)),(0,t.jsx)(y.ZP,{type:"dashed",onClick:()=>o([...l,{username:"",password:"",userType:""}]),block:!0,children:"Add Another User"}),"username,password,user_type"!==c.trim()&&(0,t.jsx)(m.Z.Item,{label:"Generated CSV String",className:"mt-4",children:(0,t.jsx)(h.Z.TextArea,{value:c,readOnly:!0,autoSize:{minRows:2,maxRows:4},className:"font-mono border border-gray-300 bg-gray-100"})}),(0,t.jsx)(m.Z.Item,{children:(0,t.jsx)(y.ZP,{type:"primary",htmlType:"submit",className:"w-1/3 mx-auto block mt-20",disabled:"username,password,user_type"===c.trim(),children:"Add Users"})})]})]})};var N=a(42634),S=a(42339),_=a(21013),P=a(32062),U=a(4183);let C=e=>{let{userDets:s,context:a,getUserDets:r,loading:n,setLoading:l}=e,o=e=>{N.Z.confirm({title:"Are you sure you want to delete this user?",content:"User: ".concat(e),okText:"Yes",okType:"danger",cancelText:"No",className:"w-1/3",onOk:async()=>{l(!0);let s=await fetch((0,i.Z)("http","admin/delete_user"),{method:"POST",body:JSON.stringify({username:e,token:a.token}),headers:{"Content-Type":"application/json"}}),t=await s.json();"success"===t.status?u.ZP.success("User deleted successfully! Refreshing the user data..."):u.ZP.error("There was an error deleting the user. Please try again."),await r(),l(!1)}})};return(0,t.jsx)("div",{className:"w-4/6 max-h-screen overflow-y-auto mb-4",children:(0,t.jsx)(S.Z,{spinning:n,tip:"Getting Latest Users Data",children:(0,t.jsx)(_.Z,{className:"mt-10 border border-gray-200 rounded-lg shadow-lg bg-gray-100",dataSource:s,columns:[{title:"User ID",dataIndex:"username",key:"username",width:"33%",align:"center"},{title:"User Type",dataIndex:"user_type",key:"user_type",width:"33%",align:"center"},{title:"Action",key:"delete_user",width:"33%",align:"center",render:(e,s)=>(0,t.jsx)(P.Z,{size:"middle",children:(0,t.jsx)(y.ZP,{type:"default",icon:(0,t.jsx)(U.Z,{}),onClick:()=>o(s.username)})})}]})})})};var I=a(62071);let A=()=>{let[e,s]=(0,r.useState)(!1),[a,d]=(0,r.useState)([]),[m,h]=(0,r.useContext)(c.S),p=(0,n.useRouter)(),y=async()=>{if(s(!0),!m.token)return;let e=await fetch((0,i.Z)("http","admin/get_users"),{method:"POST",body:JSON.stringify({token:m.token}),headers:{"Content-Type":"application/json"}}),a=await e.json();a.users?d(a.users):u.ZP.error("There was an error fetching the user data. Please try again."),s(!1)};return(0,r.useEffect)(()=>{let e=m.token,s=m.userType;if(!s){let a=localStorage.getItem("defogUser");if(e=localStorage.getItem("defogToken"),s=localStorage.getItem("defogUserType"),!a||!e||!s){p.push("/log-in");return}h({user:a,token:e,userType:s})}e?y():p.push("/log-in")},[m,m.token]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Z,{}),(0,t.jsxs)(o.Z,{id:"manage-users",userType:"admin",children:[(0,t.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-5",children:[(0,t.jsxs)("h1",{children:[(0,t.jsx)(I.Z,{style:{fontSize:"3.5em",color:"#1890ff"}})," "]}),(0,t.jsx)("h1",{className:"text-3xl mt-4",children:"Manage Users"})]}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1",children:(0,t.jsx)(C,{userDets:a,context:m,getUserDets:y,loading:e,setLoading:s})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full",children:(0,t.jsx)(k,{loading:e,context:m,getUserDets:y})}),(0,t.jsx)("div",{className:"flex justify-center items-center flex-col p-1 w-full mt-4 mb-4",children:(0,t.jsx)(T,{loading:e,context:m,getUserDets:y})})]})]})};var E=A},93146:function(e,s){"use strict";let a=(e,s)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost"),""!==s)?"ws"===e?"".concat("http://localhost".replace("http","ws"),"/").concat(s):"".concat("http://localhost","/").concat(s):"".concat("http://localhost")};s.Z=a}},function(e){e.O(0,[435,919,412,629,592,13,738,286,611,425,774,888,179],function(){return e(e.s=4139)}),_N_E=e.O()}]);