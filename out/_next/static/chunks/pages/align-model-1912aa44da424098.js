(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[224],{40409:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"}},4559:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"}},66093:function(e,t,a){"use strict";var s=a(79290).default,l=a(44512).default;t.Z=void 0;var n=l(a(17963)),o=s(a(82684)),r=l(a(40409)),i=l(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,n.default)({},e,{ref:t,icon:r.default}))});t.Z=d},65683:function(e,t,a){"use strict";var s=a(79290).default,l=a(44512).default;t.Z=void 0;var n=l(a(17963)),o=s(a(82684)),r=l(a(4559)),i=l(a(32905)),d=o.forwardRef(function(e,t){return o.createElement(i.default,(0,n.default)({},e,{ref:t,icon:r.default}))});t.Z=d},81659:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/align-model",function(){return a(8141)}])},22295:function(e,t,a){"use strict";var s=a(28598),l=a(82684),n=a(33612),o=a(51728);t.Z=e=>{let{helperText:t,mainText:a,onUpdate:r,isEditable:i,inputModeOn:d=!1}=e,[c,u]=(0,l.useState)(a),[h,f]=(0,l.useState)(d),handleUpdate=()=>{r(c),f(!1)};return(0,s.jsxs)("div",{style:{backgroundColor:"#FFFAF0",borderLeft:"5px solid #FFA500",padding:"10px",margin:"10px 0",fontFamily:"Monospace",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{children:[t,"\xa0"]}),h?(0,s.jsx)(n.default,{value:c,onChange:e=>u(e.target.value),onPressEnter:handleUpdate,onBlur:handleUpdate,autoFocus:!0,style:{flex:1}}):(0,s.jsx)("span",{style:{flex:1},children:c}),i&&(0,s.jsx)(o.default,{onClick:()=>f(!h),style:{cursor:"pointer",color:"#FFA500",marginLeft:"10px"}})]})}},26335:function(e,t,a){"use strict";var s=a(28598),l=a(1887),n=a.n(l);t.Z=()=>(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,s.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]})},82067:function(e,t,a){"use strict";var s=a(28598),l=a(82684),n=a(97574),o=a(79869),r=a(34376);a(12691);var i=a(26978),d=a(47663),c=a(56572);t.Z=e=>{let{id:t,userType:a,children:u,rootClassNames:h="",contentClassNames:f=""}=e,{Content:m,Sider:g}=o.Layout,[p,x]=(0,l.useState)([]),[y,j]=(0,l.useContext)(n.S),v=(0,r.useRouter)(),redirect=e=>{v.push(e)},logout=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),j({user:null,token:null,userType:null}),redirect("/static/log-in.html")},b=(0,d.usePathname)();(0,l.useEffect)(()=>{x(("admin"==a?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:a?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:logout}]:[]).map(e=>(e.current=e.href==b,e)))},[a]);let[w,k]=(0,l.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,l.useEffect)(()=>{"/query-data"===b&&k("flex flex-col md:min-h-screen relative")},[b]),(0,s.jsxs)("div",{className:(0,c.m6)(w,h),children:[p.length?(0,s.jsx)(i.l2,{rootClassNames:"border-b",items:p}):(0,s.jsx)(s.Fragment,{}),(0,s.jsx)("div",{className:(0,c.m6)("grow",f),children:u})]})}},8141:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return align_model}});var s=a(28598),l=a(82684),n=a(26335),o=a(82067),r=a(79204),i=a(20259),d=a.n(i),c=a(49603),align_model_Instructions=e=>{let{glossary:t,setGlossary:a,updateGlossary:l,isLoading:n,isUpdatingInstructions:o}=e;return(0,s.jsxs)("div",{className:"w-full p-4",children:[(0,s.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:"Instructions"}),(0,s.jsx)("p",{className:"mb-4 text-gray-700",children:"These instructions are used by the model as a guide for the SQL queries that it generates. You can change them below."}),(0,s.jsx)(c.default,{spinning:n||o,tip:o?"Updating Instructions...":"Loading Instructions",children:(0,s.jsx)("textarea",{className:"w-full h-40 p-2 border rounded border-gray-300 shadow-sm focus:border-gray-500 focus:ring focus:ring-gray-200 transition duration italic",value:t,onChange:e=>a(e.target.value),rows:8,disabled:n})}),(0,s.jsx)(d(),{type:"primary",className:"mt-4 h-auto p-2 min-w-56",onClick:l,disabled:n||o,children:"Update Instructions"})]})},u=a(10998),h=a(33612),f=a(35575),m=a(51728),g=a(31585),p=a(66093),x=a(22295),y=a(22399),j=a(73638),align_model_AddQueryModal=e=>{let{handleOk:t,handleCancel:a,newQuestion:l,setNewQuestion:n,newSql:o,setNewSql:r}=e;return(0,s.jsxs)(y.default,{title:(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center text-xl mb-4",children:[(0,s.jsx)(j.default,{className:"text-yellow-500 mb-4 font-bold",style:{fontSize:"3em"}}),(0,s.jsx)("h1",{children:" Add Golden Query "})]}),onOk:t,onCancel:a,open:!0,className:"w-1/2",children:[(0,s.jsx)(x.Z,{helperText:"Question: ",mainText:l,onUpdate:n,isEditable:!0,inputModeOn:!0}),(0,s.jsx)(h.default.TextArea,{placeholder:"SQL Query",value:o,onChange:e=>r(e.target.value),rows:4,className:"min-h-52 font-mono text-sm p-2 bg-gray-50 border border-gray-300"})]})},align_model_GoldenQueries=e=>{let{goldenQueries:t,setGoldenQueries:a,isLoading:n,isUpdatingGoldenQueries:o,setUpdatedGoldenQueriesToggle:r}=e,[i,y]=(0,l.useState)(Array(t.length).fill(!1)),[j,v]=(0,l.useState)(!1),[b,w]=(0,l.useState)(""),[k,_]=(0,l.useState)(""),toggleEditMode=e=>{let t=[...i];t[e]=!t[e],y(t)},S=[{title:"Question",dataIndex:"question",key:"question",width:"30%",render:(e,l,r)=>i[r]?(0,s.jsx)(h.default.TextArea,{value:e,onChange:e=>{let s=[...t];s[r].question=e.target.value,a(s)},rows:1,disabled:n||o}):(0,s.jsx)(x.Z,{helperText:"",mainText:e,onUpdate:()=>{},isEditable:!1})},{title:"SQL Query",dataIndex:"sql",key:"sql",width:"65%",render:(e,l,r)=>i[r]?(0,s.jsx)(h.default.TextArea,{value:e,onChange:e=>{let s=[...t];s[r].sql=e.target.value,a(s)},rows:4,disabled:n||o,className:"font-mono text-sm p-2 bg-gray-50 border border-gray-300"}):(0,s.jsx)("pre",{className:"whitespace-pre-wrap bg-gray-100 max-h-72 overflow-auto",children:e})},{title:"Actions",key:"actions",width:"5%",align:"center",render:(e,l,c)=>(0,s.jsxs)(f.default,{children:[(0,s.jsx)(d(),{icon:i[c]?(0,s.jsx)(p.Z,{onClick:()=>r(e=>!e)}):(0,s.jsx)(m.default,{}),onClick:()=>toggleEditMode(c),disabled:n||o}),(0,s.jsx)(d(),{icon:(0,s.jsx)(g.default,{}),type:"primary",danger:!0,onClick:async()=>{let e=[...t];e.splice(c,1),a(e),y(i.filter((e,t)=>t!==c)),r(e=>!e)},disabled:n||o})]})}];return(0,s.jsxs)("div",{className:"w-full p-4 mb-4",children:[(0,s.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:"Golden Queries"}),(0,s.jsx)("p",{className:"mb-6 text-gray-700",children:"The golden queries are SQL queries used as examples by the model to learn about how your database is structured. You can see and edit them below."}),(0,s.jsx)(c.default,{spinning:n||o,tip:o?"Updating Golden Queries...":"Loading Golden Queries",children:(0,s.jsx)("div",{className:"max-h-screen overflow-auto",children:(0,s.jsx)(u.default,{columns:S,dataSource:t.map((e,t)=>({...e,key:t})),pagination:!1})})}),(0,s.jsx)(d(),{type:"primary",className:"mt-4 h-auto p-2 min-w-56",onClick:()=>v(!0),disabled:n||o,children:"Add new Question and Query"}),j&&(0,s.jsx)(align_model_AddQueryModal,{handleOk:()=>{b&&k&&(a([...t,{question:b,sql:k}]),w(""),_(""),v(!1),r(e=>!e))},handleCancel:()=>{w(""),_(""),v(!1)},newQuestion:b,setNewQuestion:w,newSql:k,setNewSql:_})]})},v=a(18953),b=a(65683),w=a(37490),k=a(92696),_=a(24788),align_model=()=>{let[e,t]=(0,l.useState)(!1),[a,i]=(0,l.useState)(""),[d,c]=(0,l.useState)([]),[u,h]=(0,l.useState)(""),[f,m]=(0,l.useState)(!1),[g,p]=(0,l.useState)(!1),[x,y]=(0,l.useState)(!1),[j,S]=(0,l.useState)(!1),N="Defog".split(","),[Q,C]=(0,l.useState)(N[0]);(0,l.useEffect)(()=>{let t=localStorage.getItem("defogToken");h(t),getGlossaryGoldenQueries(e)},[e,Q]),(0,l.useEffect)(()=>{updateGoldenQueries()},[j]);let getGlossaryGoldenQueries=async e=>{m(!0);let t=localStorage.getItem("defogToken");console.log("Right now, devMode is",e);try{let a=await fetch((0,r.Z)("http","integration/get_glossary_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,dev:e,key_name:Q})}),s=await a.json();i(s.glossary),c(s.golden_queries),m(!1)}catch(e){console.error(e),m(!1),v.default.error("Failed to get instructions. Are you sure you have updated your database credentials?")}},updateGlossary=async()=>{p(!0);let t=await fetch((0,r.Z)("http","integration/update_glossary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glossary:a,token:u,dev:e,key_name:Q})}),s=await t.json();p(!1),"success"===s.status&&v.default.success("Instructions updated successfully!")},updateGoldenQueries=async()=>{y(!0);let t=await fetch((0,r.Z)("http","integration/update_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u,golden_queries:d,dev:e,key_name:Q})}),a=await t.json();y(!1),"success"===a.status&&v.default.success("Golden queries updated successfully!")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Z,{}),(0,s.jsxs)(o.Z,{id:"align-model",userType:"admin",children:[N.length>1?(0,s.jsx)(w.default,{type:"flex",height:"100vh",children:(0,s.jsx)(k.default,{span:24,style:{paddingBottom:"1em"},children:(0,s.jsx)(_.default,{style:{width:"100%"},onChange:e=>{C(e)},options:N.map(e=>({value:e,key:e,label:e})),value:Q})})}):null,(0,s.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-1",children:[(0,s.jsxs)("h1",{children:[(0,s.jsx)(b.Z,{style:{fontSize:"3em",color:"#1890ff"}})," "]}),(0,s.jsx)("h1",{className:"text-3xl mt-4",children:"Align Model"}),(0,s.jsx)("p",{className:"m-4",children:"Here, you can see the instructions and golden queries that the model is currently using to create SQL queries. Feel free to change them to get the best results."})]}),(0,s.jsxs)("div",{className:"flex flex-col p-1 border border-gray-3200 rounded-lg",children:[(0,s.jsx)(align_model_Instructions,{glossary:a,setGlossary:i,updateGlossary:updateGlossary,isLoading:f,isUpdatingInstructions:g}),(0,s.jsx)(align_model_GoldenQueries,{goldenQueries:d,setGoldenQueries:c,isLoading:f,isUpdatingGoldenQueries:x,setUpdatedGoldenQueriesToggle:S})]})]})]})}},79204:function(e,t){"use strict";t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost:33364"),""!==t)?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")}}},function(e){e.O(0,[435,774,888,179],function(){return e(e.s=81659)}),_N_E=e.O()}]);