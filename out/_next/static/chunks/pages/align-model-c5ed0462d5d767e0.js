(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[224],{4183:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var a=s(65260),l=s(82684),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},r=s(92902),o=l.forwardRef(function(e,t){return l.createElement(r.Z,(0,a.Z)({},e,{ref:t,icon:n}))})},30652:function(e,t,s){"use strict";var a=s(12191);t.Z=a.Z},84672:function(e,t,s){"use strict";var a=s(75178);t.Z=a.Z},81659:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/align-model",function(){return s(82820)}])},9857:function(e,t,s){"use strict";var a=s(28598),l=s(82684),n=s(80128),r=s(46835);let o=e=>{let{helperText:t,mainText:s,onUpdate:o,isEditable:i,inputModeOn:c=!1}=e,[d,u]=(0,l.useState)(s),[h,m]=(0,l.useState)(c),g=()=>{o(d),m(!1)},f=()=>m(!h);return(0,a.jsxs)("div",{style:{backgroundColor:"#FFFAF0",borderLeft:"5px solid #FFA500",padding:"10px",margin:"10px 0",fontFamily:"Monospace",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:[t,"\xa0"]}),h?(0,a.jsx)(n.Z,{value:d,onChange:e=>u(e.target.value),onPressEnter:g,onBlur:g,autoFocus:!0,style:{flex:1}}):(0,a.jsx)("span",{style:{flex:1},children:d}),i&&(0,a.jsx)(r.Z,{onClick:f,style:{cursor:"pointer",color:"#FFA500",marginLeft:"10px"}})]})};t.Z=o},42449:function(e,t,s){"use strict";var a=s(28598),l=s(1887),n=s.n(l);let r=()=>(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Defog.ai - AI Assistant for Data Analysis"}),(0,a.jsx)("meta",{name:"description",content:"Train your AI data assistant on your own device"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]});t.Z=r},22500:function(e,t,s){"use strict";var a=s(28598),l=s(82684),n=s(36189),r=s(79869),o=s(34376);s(12691);var i=s(26978),c=s(47663),d=s(56572);let u=e=>{let{id:t,userType:s,children:u,rootClassNames:h="",contentClassNames:m=""}=e,{Content:g,Sider:f}=r.Ar,[x,p]=(0,l.useState)([]),[y,v]=(0,l.useContext)(n.S),j=(0,o.useRouter)(),w=e=>{j.push(e)},b=()=>{localStorage.removeItem("defogUser"),localStorage.removeItem("defogToken"),localStorage.removeItem("defogUserType"),v({user:null,token:null,userType:null}),w("/log-in")},Z=(0,c.usePathname)();(0,l.useEffect)(()=>{p(("admin"==s?[{key:"manage-database",title:"Manage Database",href:"/static/extract-metadata.html"},{key:"manage-users",title:"Manage Users",href:"/static/manage-users.html"},{key:"manage-tools",title:"Manage tools",href:"/static/manage-tools.html"},{key:"check-readiness",title:"Check Readiness",href:"/static/check-readiness.html"},{key:"align-model",title:"Align Model",href:"/static/align-model.html"},{key:"view-feedback",title:"View Feedback",href:"/static/view-feedback.html"},{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:s?[{key:"query-data",title:"Query Data",href:"/static/query-data.html"},{key:"logout",classNames:"self-end",title:"Logout",href:"#",onClick:b}]:[]).map(e=>(e.current=e.href==Z,e)))},[s]);let[k,S]=(0,l.useState)("flex flex-col md:min-h-screen relative container mx-auto");return(0,l.useEffect)(()=>{"/query-data"===Z&&S("flex flex-col md:min-h-screen relative")},[Z]),(0,a.jsxs)("div",{className:(0,d.m6)(k,h),children:[x.length?(0,a.jsx)(i.l2,{rootClassNames:"border-b",items:x}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)("div",{className:(0,d.m6)("grow",m),children:u})]})};t.Z=u},82820:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L}});var a=s(28598),l=s(82684),n=s(42449),r=s(22500),o=s(93146),i=s(42339),c=s(4134);let d=e=>{let{glossary:t,setGlossary:s,updateGlossary:l,isLoading:n,isUpdatingInstructions:r}=e;return(0,a.jsxs)("div",{className:"w-full p-4",children:[(0,a.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:"Instructions"}),(0,a.jsx)("p",{className:"mb-4 text-gray-700",children:"These instructions are used by the model as a guide for the SQL queries that it generates. You can change them below."}),(0,a.jsx)(i.Z,{spinning:n||r,tip:r?"Updating Instructions...":"Loading Instructions",children:(0,a.jsx)("textarea",{className:"w-full h-40 p-2 border rounded border-gray-300 shadow-sm focus:border-gray-500 focus:ring focus:ring-gray-200 transition duration italic",value:t,onChange:e=>s(e.target.value),rows:8,disabled:n})}),(0,a.jsx)(c.ZP,{type:"primary",className:"mt-4 h-auto p-2 min-w-56",onClick:l,disabled:n||r,children:"Update Instructions"})]})};var u=s(80128),h=s(32062),m=s(21013),g=s(65260),f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},x=s(92902),p=l.forwardRef(function(e,t){return l.createElement(x.Z,(0,g.Z)({},e,{ref:t,icon:f}))}),y=s(46835),v=s(4183),j=s(9857),w=s(42634),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"},Z=l.forwardRef(function(e,t){return l.createElement(x.Z,(0,g.Z)({},e,{ref:t,icon:b}))});let k=e=>{let{handleOk:t,handleCancel:s,newQuestion:l,setNewQuestion:n,newSql:r,setNewSql:o}=e;return(0,a.jsxs)(w.Z,{title:(0,a.jsxs)("div",{className:"flex flex-col justify-center items-center text-xl mb-4",children:[(0,a.jsx)(Z,{className:"text-yellow-500 mb-4 font-bold",style:{fontSize:"3em"}}),(0,a.jsx)("h1",{children:" Add Golden Query "})]}),onOk:t,onCancel:s,open:!0,className:"w-1/2",children:[(0,a.jsx)(j.Z,{helperText:"Question: ",mainText:l,onUpdate:n,isEditable:!0,inputModeOn:!0}),(0,a.jsx)(u.Z.TextArea,{placeholder:"SQL Query",value:r,onChange:e=>o(e.target.value),rows:4,className:"min-h-52 font-mono text-sm p-2 bg-gray-50 border border-gray-300"})]})},S=e=>{let{goldenQueries:t,setGoldenQueries:s,isLoading:n,isUpdatingGoldenQueries:r,setUpdatedGoldenQueriesToggle:o}=e,[d,g]=(0,l.useState)(Array(t.length).fill(!1)),[f,x]=(0,l.useState)(!1),[w,b]=(0,l.useState)(""),[Z,S]=(0,l.useState)(""),N=e=>{let t=[...d];t[e]=!t[e],g(t)},C=()=>{w&&Z&&(s([...t,{question:w,sql:Z}]),b(""),S(""),x(!1),o(e=>!e))},q=()=>{b(""),S(""),x(!1)},T=[{title:"Question",dataIndex:"question",key:"question",width:"30%",render:(e,l,o)=>d[o]?(0,a.jsx)(u.Z.TextArea,{value:e,onChange:e=>{let a=[...t];a[o].question=e.target.value,s(a)},rows:1,disabled:n||r}):(0,a.jsx)(j.Z,{helperText:"",mainText:e,onUpdate:()=>{},isEditable:!1})},{title:"SQL Query",dataIndex:"sql",key:"sql",width:"65%",render:(e,l,o)=>d[o]?(0,a.jsx)(u.Z.TextArea,{value:e,onChange:e=>{let a=[...t];a[o].sql=e.target.value,s(a)},rows:4,disabled:n||r,className:"font-mono text-sm p-2 bg-gray-50 border border-gray-300"}):(0,a.jsx)("pre",{className:"whitespace-pre-wrap bg-gray-100 max-h-72 overflow-auto",children:e})},{title:"Actions",key:"actions",width:"5%",align:"center",render:(e,l,i)=>(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(c.ZP,{icon:d[i]?(0,a.jsx)(p,{onClick:()=>o(e=>!e)}):(0,a.jsx)(y.Z,{}),onClick:()=>N(i),disabled:n||r}),(0,a.jsx)(c.ZP,{icon:(0,a.jsx)(v.Z,{}),type:"primary",danger:!0,onClick:async()=>{let e=[...t];e.splice(i,1),s(e),g(d.filter((e,t)=>t!==i)),o(e=>!e)},disabled:n||r})]})}];return(0,a.jsxs)("div",{className:"w-full p-4 mb-4",children:[(0,a.jsx)("h2",{className:"text-xl mb-3 font-semibold",children:"Golden Queries"}),(0,a.jsx)("p",{className:"mb-6 text-gray-700",children:"The golden queries are SQL queries used as examples by the model to learn about how your database is structured. You can see and edit them below."}),(0,a.jsx)(i.Z,{spinning:n||r,tip:r?"Updating Golden Queries...":"Loading Golden Queries",children:(0,a.jsx)("div",{className:"max-h-screen overflow-auto",children:(0,a.jsx)(m.Z,{columns:T,dataSource:t.map((e,t)=>({...e,key:t})),pagination:!1})})}),(0,a.jsx)(c.ZP,{type:"primary",className:"mt-4 h-auto p-2 min-w-56",onClick:()=>x(!0),disabled:n||r,children:"Add new Question and Query"}),f&&(0,a.jsx)(k,{handleOk:C,handleCancel:q,newQuestion:w,setNewQuestion:b,newSql:Z,setNewSql:S})]})};var N=s(16496),C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},q=l.forwardRef(function(e,t){return l.createElement(x.Z,(0,g.Z)({},e,{ref:t,icon:C}))}),T=s(84672),Q=s(30652),_=s(56193);let A=()=>{let[e,t]=(0,l.useState)(!1),[s,i]=(0,l.useState)(""),[c,u]=(0,l.useState)([]),[h,m]=(0,l.useState)(""),[g,f]=(0,l.useState)(!1),[x,p]=(0,l.useState)(!1),[y,v]=(0,l.useState)(!1),[j,w]=(0,l.useState)(!1),b="Demo".split(","),[Z,k]=(0,l.useState)(b[0]);(0,l.useEffect)(()=>{let t=localStorage.getItem("defogToken");m(t),C(e)},[e,Z]),(0,l.useEffect)(()=>{L()},[j]);let C=async e=>{f(!0);let t=localStorage.getItem("defogToken");console.log("Right now, devMode is",e);try{let s=await fetch((0,o.Z)("http","integration/get_glossary_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,dev:e,key_name:Z})}),a=await s.json();i(a.glossary),u(a.golden_queries),f(!1)}catch(l){console.error(l),f(!1),N.ZP.error("Failed to get instructions. Are you sure you have updated your database credentials?")}},A=async()=>{p(!0);let t=await fetch((0,o.Z)("http","integration/update_glossary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glossary:s,token:h,dev:e,key_name:Z})}),a=await t.json();p(!1),"success"===a.status&&N.ZP.success("Instructions updated successfully!")},L=async()=>{v(!0);let t=await fetch((0,o.Z)("http","integration/update_golden_queries"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:h,golden_queries:c,dev:e,key_name:Z})}),s=await t.json();v(!1),"success"===s.status&&N.ZP.success("Golden queries updated successfully!")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Z,{}),(0,a.jsxs)(r.Z,{id:"align-model",userType:"admin",children:[b.length>1?(0,a.jsx)(T.Z,{type:"flex",height:"100vh",children:(0,a.jsx)(Q.Z,{span:24,style:{paddingBottom:"1em"},children:(0,a.jsx)(_.Z,{style:{width:"100%"},onChange:e=>{k(e)},options:b.map(e=>({value:e,key:e,label:e})),value:Z})})}):null,(0,a.jsxs)("div",{className:"flex justify-center items-center flex-col p-1 mt-1",children:[(0,a.jsxs)("h1",{children:[(0,a.jsx)(q,{style:{fontSize:"3em",color:"#1890ff"}})," "]}),(0,a.jsx)("h1",{className:"text-3xl mt-4",children:"Align Model"}),(0,a.jsx)("p",{className:"m-4",children:"Here, you can see the instructions and golden queries that the model is currently using to create SQL queries. Feel free to change them to get the best results."})]}),(0,a.jsxs)("div",{className:"flex flex-col p-1 border border-gray-3200 rounded-lg",children:[(0,a.jsx)(d,{glossary:s,setGlossary:i,updateGlossary:A,isLoading:g,isUpdatingInstructions:x}),(0,a.jsx)(S,{goldenQueries:c,setGoldenQueries:u,isLoading:g,isUpdatingGoldenQueries:y,setUpdatedGoldenQueriesToggle:w})]})]})]})};var L=A},93146:function(e,t){"use strict";let s=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return(console.log("http://localhost:33364"),""!==t)?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")};t.Z=s}},function(e){e.O(0,[435,919,412,629,592,13,738,774,888,179],function(){return e(e.s=81659)}),_N_E=e.O()}]);