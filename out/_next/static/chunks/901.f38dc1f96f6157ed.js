"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[901],{66079:function(e,t,l){var a=l(44512),s=l(57288);t.Z=void 0;var r=a(l(28440)),n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=s(e)&&"function"!=typeof e)return{default:e};var l=_getRequireWildcardCache(t);if(l&&l.has(e))return l.get(e);var a={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&({}).hasOwnProperty.call(e,n)){var i=r?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(a,n,i):a[n]=e[n]}return a.default=e,l&&l.set(e,a),a}(l(82684)),i=a(l(24484)),o=a(l(32905));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,l=new WeakMap;return(_getRequireWildcardCache=function(e){return e?l:t})(e)}var c=n.forwardRef(function(e,t){return n.createElement(o.default,(0,r.default)((0,r.default)({},e),{},{ref:t,icon:i.default}))});t.Z=c},65585:function(e,t,l){let a;l.d(t,{Z:function(){return esm_browser_v4}});let s="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var r={randomUUID:s};let n=new Uint8Array(16),i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));var esm_browser_v4=function(e,t,l){if(r.randomUUID&&!t&&!e)return r.randomUUID();e=e||{};let s=e.random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){l=l||0;for(let e=0;e<16;++e)t[l+e]=s[e];return t}return function(e,t=0){return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}(s)}},84901:function(e,t,l){l.r(t),l.d(t,{default:function(){return DefogAnalysisAgentStandalone}});var a=l(15059),s=l(28598),r=l(82684);let n=r.createContext({});var i=l(65585),o=l(62588),c=l(63830),d=l(89199),u=l(40050),h=l(82001),f=l(79204),m=l(15330),y=l(22399),v=l(18953),x=l(34134),p=l(66079),g=l(56572);function AnalysisHistoryItem(e){let{analysis:t,isActive:l,setActiveAnalysisId:a,setActiveRootAnalysisId:r,setAddToDashboardSelection:n,extraClasses:i="",isDummy:o=!1}=e;return(0,s.jsxs)("div",{className:(0,g.m6)("flex flex-row items-center py-2 px-2 mb-2 hover:cursor-pointer hover:bg-gray-200 history-item",l?"font-bold bg-gray-200 ":"",o?"dummy-analysis":t.analysisId,i),onClick:()=>{r(null==t?void 0:t.rootAnalysisId),a(null==t?void 0:t.analysisId)},children:[(0,s.jsx)("div",{className:"grow",children:o?"New analysis":null==t?void 0:t.user_question}),!o&&(0,s.jsx)("div",{className:"rounded-sm hover:bg-blue-500 p-1 flex justify-center hover:text-white text-gray-300 group ",onClick:()=>{a(null==t?void 0:t.analysisId),n(t)},children:(0,s.jsx)(p.Z,{})})]})}let AnalysisVersionViewerLinks=e=>{let{analyses:t,activeAnalysisId:l}=e,[a,n]=(0,r.useState)([]),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!i.current||!l)return;let e=i.current.closest(".history-list");if(!e)return;e.querySelectorAll(".linked-active").forEach(e=>{e.classList.remove("linked-active")}),e.querySelectorAll(".current-active").forEach(e=>{e.classList.remove("current-active")});let a=e.querySelector(".".concat(l));a&&a.classList.add("current-active");let s=t[l],r=[],o=[];for(;r.length<20&&!s.isRoot;){let l=t[s.directParentId];r.push(l);let a=e.getBoundingClientRect(),n=e.querySelector(".".concat(s.analysisId)),i=e.querySelector(".".concat(l.analysisId)),c=n.getBoundingClientRect(),d=i.getBoundingClientRect(),u={x:c.left-a.left-12,y:c.top-a.top+c.height/2},h={x:d.left-a.left-12,y:d.top-a.top+d.height/2},f=h.y-u.y,m=h.x-(u.x-10),y="M ".concat(u.x," ").concat(u.y," l ").concat(-10," ").concat(0," l ").concat(0," ").concat(f," l ").concat(m," ").concat(0);o.push(y),s=l}r.forEach(t=>{let l=e.querySelector(".".concat(t.analysisId));l&&l.classList.add("linked-active")}),n(o)},[t,l]),(0,s.jsx)("div",{className:"absolute l-0 t-0 pointer-events-none overflow-visible",ref:i,children:(0,s.jsx)("svg",{width:"100%",height:"100%",className:"overflow-visible",children:a.map((e,t)=>(0,s.jsx)("path",{d:e,className:"fill-transparent stroke-blue-300 text-blue-500",strokeWidth:"1"},t))})})},b=r.forwardRef(function({title:e,titleId:t,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},l),e?r.createElement("title",{id:t},e):null,r.createElement("path",{fillRule:"evenodd",d:"M17 4.25A2.25 2.25 0 0 0 14.75 2h-5.5A2.25 2.25 0 0 0 7 4.25v2a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v11.5a.75.75 0 0 1-.75.75h-5.5a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 0-1.5 0v2A2.25 2.25 0 0 0 9.25 18h5.5A2.25 2.25 0 0 0 17 15.75V4.25Z",clipRule:"evenodd"}),r.createElement("path",{fillRule:"evenodd",d:"M1 10a.75.75 0 0 1 .75-.75h9.546l-1.048-.943a.75.75 0 1 1 1.004-1.114l2.5 2.25a.75.75 0 0 1 0 1.114l-2.5 2.25a.75.75 0 1 1-1.004-1.114l1.048-.943H1.75A.75.75 0 0 1 1 10Z",clipRule:"evenodd"}))}),w=r.forwardRef(function({title:e,titleId:t,...l},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},l),e?r.createElement("title",{id:t},e):null,r.createElement("path",{fillRule:"evenodd",d:"M17 4.25A2.25 2.25 0 0 0 14.75 2h-5.5A2.25 2.25 0 0 0 7 4.25v2a.75.75 0 0 0 1.5 0v-2a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v11.5a.75.75 0 0 1-.75.75h-5.5a.75.75 0 0 1-.75-.75v-2a.75.75 0 0 0-1.5 0v2A2.25 2.25 0 0 0 9.25 18h5.5A2.25 2.25 0 0 0 17 15.75V4.25Z",clipRule:"evenodd"}),r.createElement("path",{fillRule:"evenodd",d:"M14 10a.75.75 0 0 0-.75-.75H3.704l1.048-.943a.75.75 0 1 0-1.004-1.114l-2.5 2.25a.75.75 0 0 0 0 1.114l2.5 2.25a.75.75 0 1 0 1.004-1.114l-1.048-.943h9.546A.75.75 0 0 0 14 10Z",clipRule:"evenodd"}))});var j=l(25473);function Collapse(e){let{children:t,title:l,rootClassName:a="",headerClassNames:n=""}=e,[i,o]=(0,r.useState)(!1),c=(0,r.useRef)(null);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:(0,g.m6)("flex flex-col max-h-96 mb-2 pointer-events-auto cursor-pointer",a),onClick:()=>{if(console.log("bleh"),o(!i),c.current){let e=c.current.querySelector(".content");e&&(c.current.style.maxHeight=i?"".concat(e.scrollHeight,"px"):"0px")}},children:[(0,s.jsxs)("div",{className:(0,g.m6)("h-10 flex items-center",n),children:[(0,s.jsx)(j.Z,{className:"w-4 h-4 inline fill-gray-500",style:{transition:"transform 0.3s ease-in-out",marginRight:"3px",top:"1px",transform:i?"rotate(0deg)":"rotate(90deg)"}}),(0,s.jsx)("span",{className:"font-bold text-md",children:l})]}),(0,s.jsx)("div",{ref:c,style:{overflow:"hidden",maxHeight:"0px",transition:"max-height 0.6s ease-in-out"},children:(0,s.jsx)("div",{className:"content",children:t})})]})})}function Sidebar(e){let{title:t="Menu",children:l,rootClassNames:a="",contentClassNames:n=""}=e,[i,o]=(0,r.useState)(!0),c=(0,r.useRef)(null),d=(0,r.useRef)(null),handleClick=()=>{d.current&&c.current&&(i?(d.current.style.width="0px",o(!1)):(d.current.style.width="".concat(c.current.clientWidth,"px"),o(!0)))};return(0,r.useEffect)(()=>{d.current&&c.current&&(d.current.style.width="".concat(c.current.clientWidth,"px"))},[]),(0,s.jsxs)("div",{className:(0,g.m6)("relative",a),children:[(0,s.jsxs)("div",{className:"hidden lg:block",children:[(0,s.jsx)("button",{className:"toggle-button absolute top-5 z-10 right-5 cursor-pointer",onClick:()=>handleClick(),children:(0,s.jsx)(w,{className:"h-4 w-4"})}),(0,s.jsx)("div",{ref:d,className:"overflow-hidden transition-all",children:(0,s.jsxs)("div",{className:(0,g.m6)("content w-80 ",n),ref:c,children:[(0,s.jsx)("h2",{className:"px-2 mb-3",children:t}),l]})})]}),(0,s.jsx)("div",{className:"lg:hidden",children:(0,s.jsx)(Collapse,{title:t,rootClassName:"rounded-t-md p-2",children:l})})]})}var agent_AnalysisVersionViewer=function(e){let{dashboards:t,token:l,devMode:a,maxRenderedAnalysis:n=2}=e,[o,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[h,f]=(0,r.useState)([]),[m,g]=(0,r.useState)({}),[w,j]=(0,r.useState)({}),[A,N]=(0,r.useState)(!1),I=(0,r.useRef)(null),[k,_]=(0,r.useState)(!1),[S,R]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!I.current)return;let e=["A boxplot of ...","Show me the average of ...","What is the highest ..."],t=0,l=null,a=null,showNextQuestion=()=>{let s=0;l=setInterval(()=>{I.current&&(I.current.placeholder=e[t].slice(0,s),++s>e[t].length&&(clearInterval(l),t=(t+1)%e.length,a=setTimeout(showNextQuestion,2e3)))},80)};return showNextQuestion(),()=>{clearInterval(l),clearTimeout(a)}});let C=(0,r.useCallback)((e,t,l)=>{try{N(!0);let a="analysis-"+(0,i.Z)(),s={analysisId:a,isRoot:t,rootAnalysisId:t?a:e,user_question:I.current.value};s.directParentId=l;let r={user_question:I.current.value,is_root_analysis:t,root_analysis_id:e,direct_parent_id:l};s.createAnalysisRequestBody={other_data:r};let o={...m};if(e){let t=m[e].root;o[t.analysisId].versionList.push(s)}else u(s.analysisId),o[s.analysisId]={root:s,versionList:[]};console.groupCollapsed("Analysis version viewer"),console.groupEnd(),g(o),c(s.analysisId),u(s.rootAnalysisId),I.current.value="",j({...w,[s.analysisId]:s}),f(e=>e.length>=n?[...e.slice(1),s]:[...e,s])}catch(e){v.default.error("Failed to create analysis: "+e)}finally{N(!1)}},[m,w]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"max-w-full flex flex-col-reverse lg:flex-row bg-gray-50 min-h-96 rounded-md text-gray-600 border border-gray-300 w-full",id:"analysis-version-viewer",children:[(0,s.jsxs)("div",{className:"grow rounded-tr-lg pb-14 pt-5 pl-5 relative min-w-0",children:[o&&!h.some(e=>e.analysisId===o)&&(0,s.jsx)("div",{className:"relative z-2 overflow-auto",children:(0,s.jsx)(x.N,{analysisId:o,createAnalysisRequestBody:o===d?m[d].root.createAnalysisRequestBody:m[d].versionList.find(e=>e.analysisId===o).createAnalysisRequestBody,token:l,initiateAutoSubmit:!0,searchRef:I,setGlobalLoading:N,devMode:a})},o),h.map(e=>(0,s.jsx)("div",{className:o===e.analysisId?"relative z-2 w-full overflow-auto":"absolute opacity-0",children:(0,s.jsx)(x.N,{analysisId:e.analysisId,createAnalysisRequestBody:e.createAnalysisRequestBody,token:l,initiateAutoSubmit:!0,searchRef:I,setGlobalLoading:N,devMode:a})},e.analysisId)),!o&&(0,s.jsx)("div",{className:"w-full h-full place-content-center m-auto",children:(0,s.jsx)("p",{className:"w-1/4 m-auto text-gray-400 text-center",children:"Ask and press Enter"})}),(0,s.jsxs)("div",{className:"w-10/12 m-auto lg:w-3/4 sticky bottom-14 z-10 bg-white right-0 border-2 border-gray-400 p-2 rounded-lg h-16 shadow-custom hover:border-blue-500 focus:border-blue-500 flex",children:[(0,s.jsx)("input",{className:"block w-full rounded-none rounded-l-md border-0 py-1.5 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 sm:text-lg sm:leading-6",type:"text",ref:I,onKeyDown:e=>{"Enter"===e.key&&C(d,!d,o)},placeholder:"Show me 5 rows",disabled:A}),(0,s.jsxs)("button",{type:"button",className:"relative -ml-px inline-flex items-center gap-x-1.5 rounded-r-md px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-blue-500 hover:bg-blue-500 hover:text-white",onClick:()=>{C(d,!d,o)},children:[(0,s.jsx)(b,{className:"-ml-0.5 h-5 w-5 text-gray-400","aria-hidden":"true"}),"Ask"]})]})]}),(0,s.jsx)("div",{className:"flex flex-col mr-0",children:(0,s.jsx)(Sidebar,{title:"History",rootClassNames:"z-20 rounded-md lg:rounded-none lg:rounded-tr-md bg-gray-100",contentClassNames:"px-2 pt-5 pb-14 rounded-tl-lg relative sm:block",children:(0,s.jsxs)("div",{className:"flex flex-col px-2 relative history-list",children:[(0,s.jsx)(AnalysisVersionViewerLinks,{analyses:w,activeAnalysisId:o}),Object.keys(m).map((e,t)=>{let l=m[e].root,a=m[e].versionList;return(0,s.jsxs)("div",{children:[(0,s.jsx)(AnalysisHistoryItem,{analysis:l,isActive:o===l.analysisId,setActiveRootAnalysisId:u,setActiveAnalysisId:c,setAddToDashboardSelection:_}),a.map((e,t)=>(0,s.jsx)(AnalysisHistoryItem,{analysis:e,isActive:o===e.analysisId,setActiveRootAnalysisId:u,setActiveAnalysisId:c,setAddToDashboardSelection:_,extraClasses:"ml-2 border-l-2"},e.analysisId))]},l.analysisId)}),d?(0,s.jsxs)("div",{className:"w-full mt-5 sticky bottom-5",children:[(0,s.jsxs)("div",{"data-enabled":!A,className:"cursor-pointer z-20 relative data-[enabled=true]:bg-blue-200 data-[enabled=true]:hover:bg-blue-500 data-[enabled=true]:hover:text-white p-2 data-[enabled=true]:text-blue-400 data-[enabled=true]:shadow-custom data-[enabled=false]:bg-gray-100 data-[enabled=false]:hover:bg-gray-100 data-[enabled=false]:hover:text-gray-400 data-[enabled=false]:text-gray-400 data-[enabled=false]:cursor-not-allowed",onClick:()=>{A||(u(null),c(null))},children:["New ",(0,s.jsx)(p.Z,{})]}),(0,s.jsx)("div",{className:"absolute w-full h-10 bg-gray-100 z-0"})]}):(0,s.jsx)(AnalysisHistoryItem,{isDummy:!0,setActiveRootAnalysisId:u,setActiveAnalysisId:c,isActive:!d})]})})})]})}),(0,s.jsx)(y.default,{title:"Select the dashboards to add this analysis to",open:k,onOk:()=>{console.log(S)},onCancel:()=>{_(!1)},children:(0,s.jsx)("div",{className:"dashboard-selection mt-8 flex flex-col max-h-80 overflow-scroll bg-gray-100 rounded-md",children:t.map(e=>(0,s.jsxs)("div",{className:"flex flex-row p-2 hover:bg-gray-200 cursor-pointer text-gray-400 items-start "+(S.includes(e.doc_id)&&"text-gray-600 font-bold"),onClick:()=>{S.includes(e.doc_id)?R(S.filter(t=>t!==e.doc_id)):R([...S,e.doc_id])},children:[(0,s.jsx)("div",{className:"checkbox mr-3",children:(0,s.jsx)("input",{className:"appearance-none w-3 h-3 border border-gray-300 rounded-md checked:bg-blue-600 checked:border-transparent",type:"checkbox",checked:S.includes(e.doc_id),readOnly:!0})}),(0,s.jsx)("div",{className:"grow",children:e.doc_title})]},e.doc_id))})})]})};function _templateObject(){let e=(0,a._)([""]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,a._)(['\n  @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900");\n  @import url("https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap");\n']);return _templateObject1=function(){return e},e}function DefogAnalysisAgentStandalone(e){let{analysisId:t,token:l,devMode:a}=e,[y,v]=(0,r.useState)({}),[x,p]=(0,r.useState)(t||"analysis-"+(0,i.Z)()),[g,b]=(0,r.useState)((0,r.useContext)(o.S)),[w,j]=(0,r.useState)((0,r.useContext)(c.g)),[N,I]=(0,r.useState)((0,r.useContext)(o.OR)),[k,_]=(0,r.useState)(null),[S,R]=(0,r.useState)(null),[C,E]=(0,r.useState)(null),[O,q]=(0,r.useState)([]);(0,r.useEffect)(()=>((async function(){let e=g.userItems,t=await (0,d.Xp)(),a=await (0,d.df)(l);(null==a?void 0:a.success)&&q(a.docs),t&&t.success&&(e.analyses=t.analyses);let s=(0,f.Z)("ws","ws"),r=await (0,m.i)(s);_(r);let n=await (0,m.i)(s.replace("/ws","/step_rerun"));E(n);let i=await (0,m.i)(s.replace("/ws","/edit_tool_run"),e=>console.log(e));R(i),b({...g,userItems:e,socketManagers:{mainManager:r,reRunManager:n,toolSocketManager:i}})})(),()=>{k&&k.close&&(k.close(),k.clearSocketTimeout()),C&&C.close&&(C.close(),C.clearSocketTimeout()),S&&S.close&&(S.close(),S.clearSocketTimeout())}),[]);let M=(0,u.vJ)(_templateObject());return(0,s.jsx)(h.Z,{children:(0,s.jsx)(o.OR.Provider,{value:{val:N,update:I},children:(0,s.jsx)(c.g.Provider,{value:{val:w,update:j},children:(0,s.jsx)(o.S.Provider,{value:{val:g,update:b},children:(0,s.jsxs)(n.Provider,{value:[y,v],children:[(0,s.jsx)(M,{}),(0,s.jsx)(A,{children:(0,s.jsx)("div",{className:"content md:w-11/12",children:(0,s.jsx)("div",{className:"editor-container mt-4 mb-8 max-w-screen-xl w-full",children:(0,s.jsx)("div",{className:"defog-analysis-container",children:(0,s.jsx)("div",{"data-content-type":"analysis","data-analysis-id":t,children:(0,s.jsx)(agent_AnalysisVersionViewer,{token:l,dashboards:O,devMode:a})})})})})})]})})})})})}let A=u.ZP.div.withConfig({componentId:"sc-fc2ee7ec-0"})(_templateObject1())}}]);