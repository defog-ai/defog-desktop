"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[145,872],{97417:function(e,t,a){a.r(t),a.d(t,{Editor:function(){return Editor},default:function(){return eo}});var n=a(28598),l=a(23813),r=a(82684),s=a(89199),i=a(81206),o=a(15059),c=a(40050),d=a(34134),u=a(82001);function _templateObject(){let e=(0,o._)(['div [data-id="','"] {\n  margin: 0.2em 0 !important;\n}']);return _templateObject=function(){return e},e}let v=(0,l.k2)({type:"analysis",propSchema:{analysisId:{default:null}},content:"none"},{render:e=>{var t;let{block:a,editor:l}=e,r=(t=a.id,(0,c.vJ)(_templateObject(),t));return(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(r,{}),(0,n.jsx)(d.N,{analysisId:a.props.analysisId,token:l.token,editor:l,block:a})]})}});var h=a(94778),m=a(10998),p=a(20259),g=a.n(p),f=a(18953),b=a(99263),x=a(86739),y=a(86447),j=a(85754),w=a(78278),S=a(33982),C=a(94109),k=a(48948),_=a.n(k),N=a(59705);a(74979),a(12165),a(97141),a(89596);var T=a(18007),L=a(69819),I=a.n(L),M=a(63800),D=a(89921),A=a(63830),E=a(15330),R=a(79204);function TableChart(e){let{tableId:t,tabBarLeftContent:a=null,analysisData:l}=e,[i,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[v,p]=(0,r.useState)(null),[k,L]=(0,r.useState)(null),[O,P]=(0,r.useState)(null),[Z,V]=(0,r.useState)(!1),[q,F]=(0,r.useState)(null),H=(0,r.useContext)(A.g),B=(0,r.useRef)(null),Q=(0,r.useCallback)(e=>{if(!e)return;let a=e.data_csv.split("\n")[0].split(","),n=e.data_csv.split("\n").slice(1).map(e=>e.split(",")),r=(0,y.LS)(n,a);o({columns:r.newCols,data:r.newRows}),d(e),L(e.sql),P(e.code),e.reactive_vars&&(F(e.reactive_vars),Object.defineProperty(e.reactive_vars,"analysisData",{get:()=>l}),H.update(a=>({...a,[t]:e.reactive_vars})))},[H.val,t]),z=[];function onMessage(e){console.log(e);let t=JSON.parse(e.data);if(console.log("Ran again response",t),!(null==t?void 0:t.success)){(null==t?void 0:t.error_message)&&f.default.error("Failed with error: "+(null==t?void 0:t.error_message)),V(!1);return}Q(t.table_data),f.default.success("Ran again successfully."),V(!1)}(0,r.useEffect)(()=>{(async function(){try{let e=(0,R.Z)("ws","table_chart"),a=await (0,E.i)(e,onMessage);p(a);let n=await (0,s.WJ)(t);if(!n.success)return;n=n.table_data,Q(n)}catch(e){console.log(e)}})()},[t]),(0,r.useEffect)(()=>{if(!B.current)return;let e=B.current.getElementsByClassName("table-chart-reactive-var");Array.from(e).forEach(e=>{e.ondragstart=t=>{t.stopPropagation(),t.dataTransfer.clearData(),t.dataTransfer.setData("text/html","<reactive-var\n            data-reactive-var='true'\n            data-reactive-var-name=".concat(e.dataset.reactiveVarName,"\n            data-val=").concat((0,s.QV)(+e.dataset.val),"\n            data-reactive-var-nest-location=").concat(e.dataset.reactiveVarNestLocation,"\n            data-table-id=").concat(e.dataset.tableId,">\n          </reactive-var>"))}})},[q]);let updateCodeAndSql=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0;("sql"===e||"code"===e)&&v&&t&&a&&("sql"===e&&L(a),"code"===e&&P(a),d(t=>({...t,[e]:a,edited:!0})))},K=(0,r.useMemo)(()=>{if(z&&Array.isArray(z)&&z.every(e=>e.component&&e.tabLabel)&&z.every(e=>(0,r.isValidElement)(e.component))||(z=[]),!c||!i)return(0,n.jsx)(D.Ni.Provider,{value:{theme:{type:"light",config:D.de}},children:(0,n.jsx)(T.Z,{message:"Loading table",lottie:(0,n.jsx)(I(),{animationData:M,loop:!0})})});let e=(0,y.qz)(i.data,i.columns),t=c.chart_images,l=[{component:(0,n.jsx)(m.default,{dataSource:e,columns:i.columns.filter(e=>"index"!==e.title),size:"small",pagination:{pageSize:8,showSizeChanger:!1}},"0"),tabLabel:"Table",icon:(0,n.jsx)(w.Z,{})}];if(!t||t.length<=0){let{xAxisColumns:e,categoricalColumns:t,yAxisColumns:a,xAxisColumnValues:r,dateColumns:s}=(0,y.XA)(i.data,i.columns);l.push({component:(0,n.jsx)(u.Z,{children:(0,n.jsx)(x.Z,{xAxisColumns:e,dateColumns:s,categoricalColumns:t,yAxisColumns:a,xAxisColumnValues:r,data:i.data,columns:i.columns,title:c.query,vizType:"Bar Chart"},"1")}),tabLabel:"Chart",icon:(0,n.jsx)(S.Z,{})})}else l.push({component:(0,n.jsx)(u.Z,{children:(0,n.jsx)(C.Z,{images:t})}),tabLabel:y.Mf[t[0].type]||"Chart"});return null!==k&&l.push({component:(0,n.jsx)(u.Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"The following query was generated:"}),(0,n.jsx)(_(),{className:"language-sql table-code-ctr",value:k,highlight:e=>(0,N.highlight)(e,N.languages.sql,"sql"),onValueChange:e=>updateCodeAndSql("sql",e)})]})}),tabLabel:"SQL"}),null!==O&&l.push({component:(0,n.jsx)(u.Z,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"The following code was run:"}),(0,n.jsx)(_(),{className:"language-python table-code-ctr",value:O,highlight:e=>(0,N.highlight)(e,N.languages.python,"python"),onValueChange:e=>updateCodeAndSql("code",e)})]})}),tabLabel:"Code"}),l=l.concat(z),l=(0,n.jsx)(h.default,{tabBarExtraContent:{right:c.edited?(0,n.jsx)(g(),{onClick:runAgain,className:"edited-button",type:"primary",children:Z?"Running...":"Run again"}):(0,n.jsx)(n.Fragment,{}),left:a||(0,n.jsx)(n.Fragment,{})},defaultActiveKey:t&&t.length?"1":"0",items:l.map((e,t)=>({key:String(t),label:(0,n.jsxs)("span",{children:[e.icon?e.icon:null,e.tabLabel?e.tabLabel:"Tab-".concat(t)]}),children:e.component}))})},[c,i]),U=(0,r.useMemo)(()=>{if(!q||"object"!=typeof q||Object.keys(q).length<=0)return(0,n.jsx)(n.Fragment,{});if(q&&"object"==typeof q&&Object.keys(q).length>0){let e=Object.keys(q);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"table-chart-reactive-var-ctr",children:(0,n.jsxs)("div",{className:"sticky",children:[(0,n.jsx)("p",{className:"small",children:"STATISTICS"}),e.map(e=>(function nestedDivsUntilNumericKeys(e,a,l){return"object"==typeof a[e]?(0,n.jsx)("div",{className:"table-chart-reactive-var-group",children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"table-chart-reactive-var-group-name",children:e}),(0,n.jsx)("div",{className:"table-chart-reactive-var-vals",children:Object.keys(a[e]).map(t=>nestedDivsUntilNumericKeys(t,a[e],l+"---"+t))})]})},e):(0,n.jsxs)("div",{className:"table-chart-reactive-var","data-reactive-var-name":e,"data-val":a[e],"data-reactive-var-nest-location":l,"data-table-id":t,draggable:"true",children:[(0,n.jsx)("span",{className:"reactive-var-name",children:e}),(0,n.jsxs)(b.default,{content:()=>(0,n.jsx)("span",{children:a[e]}),rootClassName:"reactive-var-popover-val",arrow:!1,placement:"left",children:[(0,n.jsx)("span",{className:"reactive-var-value",onClick:()=>{let n=new ClipboardItem({"text/html":new Blob(["<reactive-var\n                              data-reactive-var='true'\n                              data-reactive-var-name=".concat(e,"\n                              data-val=").concat((0,s.QV)(+a[e]),"\n                              data-reactive-var-nest-location=").concat(l,"\n                              data-table-id=").concat(t,">\n                            </reactive-var>&nbsp;")],{type:"text/html"})});navigator.clipboard.write([n]).then(()=>{f.default.success("Copied to clipboard.")})},children:(0,s.QV)(a[e])}),(0,n.jsx)(j.Dup,{className:"reactive-var-copy-icon",title:"Copy",onClick:()=>{let n=new ClipboardItem({"text/html":new Blob(["<reactive-var\n                              data-reactive-var='true'\n                              data-reactive-var-name=".concat(e,"\n                              data-val=").concat((0,s.QV)(+a[e]),"\n                              data-reactive-var-nest-location=").concat(l,"\n                              data-table-id=").concat(t,">\n                            </reactive-var>&nbsp;")],{type:"text/html"})});navigator.clipboard.write([n]).then(()=>{f.default.success("Copied to clipboard.")})}})]})]},e)})(e,q,e))]})})})}},[q]);function runAgain(){if(!v.isConnected()||!v){f.default.error("Not connected to the servers.");return}V(!0),v.send({run_again:!0,table_id:t,data:c})}return(0,n.jsxs)("div",{className:"table-chart-ctr",ref:B,children:[K,U]})}var O=a(82673);let P=(0,l.k2)({type:"table-chart",content:"none",propSchema:{id:{default:null}}},{render:e=>{let{block:t,editor:a}=e;return(0,n.jsx)(O.Z,{children:(0,n.jsx)(TableChart,{tableId:t.props.id||t.id})})}}),Z={...i.SJ};delete Z.table;let V=i.Xy.create({blockSpecs:{...Z,analysis:v,"table-chart":P}}),createEditorConfig=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{blockSpecs:V,defaultStyles:!0,collaboration:{provider:t,fragment:e.getXmlFragment("document-store"),user:{name:a||"Anonymous-"+Math.floor(1e5*Math.random()),color:(0,s.c8)()}}}};var q=a(87930),F=a(11590);a(92639);let CustomFormattingToolbar=()=>{let[e,t]=(0,r.useState)(!0),a=(0,l.Q1)();return(0,l.yH)(()=>{var e,n;t(-1===s.Q1.indexOf(null===(n=a.getTextCursorPosition())||void 0===n?void 0:null===(e=n.block)||void 0===e?void 0:e.type)&&void 0!==a.getSelection())},a),e?(0,n.jsxs)(l.DR,{children:[(0,n.jsx)(l.lI,{editor:a,toggledStyle:"bold"}),(0,n.jsx)(l.lI,{editor:a,toggledStyle:"italic"}),(0,n.jsx)(l.lI,{editor:a,toggledStyle:"underline"}),(0,n.jsx)(l.lI,{editor:a,toggledStyle:"strike"}),(0,n.jsx)(l.Df,{editor:a,textAlignment:"left"}),(0,n.jsx)(l.Df,{editor:a,textAlignment:"center"}),(0,n.jsx)(l.Df,{editor:a,textAlignment:"right"}),(0,n.jsx)(l.GY,{editor:a}),(0,n.jsx)(l.fe,{editor:a})]}):null};var H=a(42677),B=a(5777);function OtherDocs(e){let{token:t,currentDocId:a}=e,[l,i]=(0,r.useState)([]);(0,r.useEffect)(()=>{!async function(){try{let e=await (0,s.UU)(t);e.success&&i(e.docs)}catch(e){console.log(e)}}()},[]);let o=(0,r.useMemo)(()=>l.filter(e=>e.doc_id!==a).map(e=>({key:e.doc_id,label:(0,n.jsx)("a",{href:"?docId="+e.doc_id,target:"_blank",rel:"noreferrer",children:(0,n.jsx)("p",{children:e.doc_title||"Untitled"})})})),[l]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(B.default,{menu:{items:o},trigger:"click",children:(0,n.jsx)("span",{children:"Open"})})})}var Q=a(57904),z=a(71393),K=a(22399),U=a(34376);function DocNav(e){let{token:t,currentDocId:a}=e,[l,i]=(0,r.useState)({"analysis-list-sidebar":!1,"db-creds-sidebar":!1}),o=(0,U.useRouter)(),[c,d]=(0,r.useState)(!1),handleDelete=async e=>{e.preventDefault(),e.stopPropagation();let t=await (0,s.oe)(a);t.success?(f.default.success("Doc deleted successfully. Redirecting to home page..."),setTimeout(()=>{o.push("/view-notebooks")},1500)):f.default.error("Error deleting doc: "+(t.error_message||"")),d(!1)};return(0,r.useEffect)(()=>{let e=document.getElementById("doc-sidebars");if(e)for(let t in l["analysis-list-sidebar"]||l["db-creds-sidebar"]?e.classList.add("open"):e.classList.remove("open"),l){let e=document.getElementById(t);if(!e)return;l[t]?e.classList.add("open"):e.classList.remove("open")}},[l]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{id:"editor-nav",children:[(0,n.jsx)("div",{id:"nav-new-doc",children:(0,n.jsx)("a",{href:"?docId=new",target:"_blank",rel:"noreferrer",children:(0,n.jsxs)("div",{title:"Start a new doc",children:[(0,n.jsx)("span",{children:"New"}),(0,n.jsx)("div",{children:(0,n.jsx)(Q.OOL,{})})]})})}),(0,n.jsx)("div",{id:"nav-other-docs",title:"List of other docs of this user",children:(0,n.jsx)(OtherDocs,{token:t,currentDocId:a})}),(0,n.jsxs)("div",{id:"nav-delete-doc",title:"Delete this doc",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(!0)},children:[(0,n.jsx)("span",{children:"Delete"}),(0,n.jsx)("div",{children:(0,n.jsx)(z.F1H,{})}),(0,n.jsx)(K.default,{okText:"Yes, delete",okType:"danger",title:"Are you sure?",open:c,onOk:handleDelete,onCancel:e=>{e.preventDefault(),e.stopPropagation(),d(!1)}})]}),(0,n.jsx)("div",{className:"nav-spacer"}),(0,n.jsx)("div",{id:"nav-analyses",className:"nav-sidebar-btn-stick-right "+(l["analysis-list-sidebar"]?"":"closed"),title:"List of other docs of this user",onClick:e=>{var t;e.preventDefault(),t="analysis-list-sidebar",i(e=>({...e,[t]:!e[t]}))},children:"Past analyses"})]})})}var J=a(62588),W=a(33612);function AnalysisList(){var e,t;let a=(0,r.useContext)(J.S),l=(0,r.useRef)(null),[s,i]=(0,r.useState)("");return(0,r.useEffect)(()=>{a.val.userItems.analyses.filter(e=>e&&e.user_question).map((e,t)=>{l.current.querySelector("#analysis-list-".concat(e.report_id)).addEventListener("dragstart",t=>{t.dataTransfer.clearData(),t.dataTransfer.setData("text/html",'<div data-content-type="analysis" data-analysis-id="'.concat(e.report_id,'"></div>'))})})},[a]),(0,n.jsx)(u.Z,{children:(0,n.jsxs)("div",{id:"analysis-list-sidebar",ref:l,className:"sidebar",children:[(0,n.jsx)(W.default,{onChange:e=>i(e.target.value),placeholder:"Filter your old analysis"}),(0,n.jsx)("div",{className:"sidebar-content",children:((null==a?void 0:null===(t=a.val)||void 0===t?void 0:null===(e=t.userItems)||void 0===e?void 0:e.analyses)||[]).filter(e=>e&&""!==e.user_question).filter(e=>{var t;return e&&(null==e?void 0:null===(t=e.user_question)||void 0===t?void 0:t.includes(s))}).map((e,t)=>(0,n.jsx)("div",{draggable:"true",id:"analysis-list-".concat(e.report_id),className:"analysis-list-sidebar-item",children:(0,n.jsx)("span",{children:e.user_question})},e.report_id))})]})})}function DocSidebars(){return(0,n.jsx)("div",{className:"doc-sidebars",children:(0,n.jsx)(AnalysisList,{})})}var X=a(73870),$=a(55160),Y=a(90293);function ReactiveVariableNodeView(e){let{node:t}=e;(0,r.useRef)(null);let a=(0,r.useContext)(A.g),l=(0,r.useMemo)(()=>{let e=t.attrs["data-reactive-var-nest-location"].split("---"),n=a.val;for(let t=0;t<e.length;t++)if(void 0!==n)n=n[e[t]];else{n=null;break}return(0,s.le)(n)||(n=(0,s.QV)(n)),n},[a]);return(0,n.jsxs)(Y.T5,{as:"span",children:[(0,n.jsx)("div",{"data-drag-handle":!0}),(0,n.jsx)("code",{"data-reactive-var":"true","data-reactive-name":t.attrs["data-reactive-var-name"],"data-reactive-var-nest-location":t.attrs["data-reactive-var-nest-location"],"data-table-id":t.attrs["data-table-id"],"data-in-ctx":!(0,s.le)(l),children:(0,s.le)(l)?t.attrs["data-val"]:l})]})}$.ZP.extend({name:"code",addAttributes:()=>({"data-reactive-var":{default:!1},"data-reactive-var-name":{default:null},"data-val":{default:null},"data-reactive-var-nest-location":{default:null},"data-table-id":{default:null},draggable:{default:!0}})});let G=X.NB.create({name:"reactive-var",group:"inline",inline:!0,selectable:!1,atom:!0,draggable:!0,addAttributes:()=>({"data-reactive-var":{default:!1},"data-reactive-var-name":{default:null},"data-val":{default:null},"data-reactive-var-nest-location":{default:null},"data-table-id":{default:null},contenteditable:{default:!1}}),parseHTML:()=>[{tag:"reactive-var"}],renderHTML(e){let{HTMLAttributes:t}=e;return["reactive-var",(0,X.P1)(t)]},addNodeView:e=>(console.log(e),(0,Y.fW)(ReactiveVariableNodeView))});var ee=a(75011),et=a(90928),ea=a(2661);function ReactiveVariableList(e){let{query:t,editor:a,range:l}=e,i=(0,r.useContext)(A.g),o=(0,r.useMemo)(()=>{let e=0,createMenuItems=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return Object.keys(t).map(l=>"object"!=typeof t[l]?(e++,{title:l+": "+t[l],key:l+": "+t[l]+"-k"+e,val:t[l],name:l,nestLocation:a+"---"+l,tableId:n}):"object"==typeof t[l]?{title:l,key:l+"-k"+ ++e,children:createMenuItems(t[l],a+"---"+l,n)}:void 0)},t=Object.keys(i.val).map(e=>{var t;return console.log(i.val,e),{title:null===(t=i.val[e])||void 0===t?void 0:t.title,key:e,children:createMenuItems(i.val[e],e,e)}});return t.flat()},[i.val]);return(0,n.jsx)(ea.default,{rootClassName:"reactive-var-list",treeData:o,defaultExpandAll:!0,showIcon:!1,showLine:!0,switcherIcon:!1,titleRender:e=>{var t;return(null===(t=e.children)||void 0===t?void 0:t.length)?(0,n.jsx)("span",{children:e.title}):(0,n.jsxs)("span",{onClick:()=>{a.commands.deleteRange(l),a.view.pasteHTML("<reactive-var\n                         data-reactive-var='true'\n                         data-reactive-var-name=".concat(e.name,"\n                         data-val=").concat((0,s.QV)(e.val),"\n                         data-reactive-var-nest-location=").concat(e.nestLocation,"\n                        data-table-id=").concat(e.tableId,">\n                      </reactive-var>")),a.commands.insertContent(" "),a.chain().focus()},children:[(0,n.jsx)("span",{className:"reactive-var-name",children:e.name}),(0,n.jsx)("span",{className:"reactive-var-value is-leaf",children:(0,s.QV)(e.val)})]})},filterTreeNode:e=>{var a,n;return null!=e&&null!==(a=e.children)&&void 0!==a&&!!a.length||(null==e?void 0:null===(n=e.title)||void 0===n?void 0:n.includes(t))}})}var en=a(39974);let el=new ee.H$("reactive-mention"),er=X.NB.create({name:"reactive-mention",addOptions(){return{HTMLAttributes:{},renderLabel(e){var t;let{options:a,node:n}=e;return"".concat(a.suggestion.char).concat(null!==(t=n.attrs.label)&&void 0!==t?t:n.attrs.id)},suggestion:{char:"@",pluginKey:el,render:()=>{let e,t;return{onStart:a=>{e=new Y.M_(ReactiveVariableList,{props:a,editor:a.editor}),a.clientRect&&(t=(0,en.ZP)("body",{getReferenceClientRect:a.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}))},onUpdate(t){if(e.updateProps(t),t.clientRect)return e},onKeyDown(a){var n;return"Escape"===a.event.key?(t[0].hide(),!0):null===(n=e.ref)||void 0===n?void 0:n.onKeyDown(a)},onExit(){t[0].destroy(),e.destroy()}}},command:e=>{var t,a;let{editor:n,range:l,props:r}=e,s=n.view.state.selection.$to.nodeAfter,i=null==s?void 0:null===(t=s.text)||void 0===t?void 0:t.startsWith(" ");i&&(l.to+=1),null===(a=window.getSelection())||void 0===a||a.collapseToEnd()},allow:e=>{let{state:t,range:a}=e,n=t.doc.resolve(a.from),l=t.schema.nodes[this.name],r=!!n.parent.type.contentMatch.matchType(l);return r}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}),parseHTML(){return[{tag:'span[data-type="'.concat(this.name,'"]')}]},renderHTML(e){let{node:t,HTMLAttributes:a}=e;return["span",(0,X.P1)({"data-type":this.name},this.options.HTMLAttributes,a),this.options.renderLabel({options:this.options,node:t})]},renderText(e){let{node:t}=e;return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(e=>{let{tr:t,state:a}=e,n=!1,{selection:l}=a,{empty:r,anchor:s}=l;return!!r&&(a.doc.nodesBetween(s-1,s,(e,a)=>{if(e.type.name===this.name)return n=!0,t.insertText(this.options.suggestion.char||"",a,a+e.nodeSize),!1}),n)})}},addProseMirrorPlugins(){return[(0,et.ZP)({editor:this.editor,...this.options.suggestion})]}});var es=a(65585);let analysisSlashMenuItem=e=>({title:"Analysis",onItemClick:()=>{let t=e.getTextCursorPosition().block,a={type:"analysis",props:{analysisId:"analysis-"+(0,es.Z)()}};e.insertBlocks([a],t)},aliases:["analysis","analyze"],group:"Data tools",icon:(0,n.jsx)("p",{children:"x y"}),subtext:"Run an analysis on your data."}),getCustomSlashMenuItems=e=>[analysisSlashMenuItem(e),...(0,l.B)(e)],ei=(0,R.Z)("http","add_to_recently_viewed_docs");function Editor(e){let{docId:t=null,token:a=null}=e,[o,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)((0,r.useContext)(J.S)),[v,h]=(0,r.useState)((0,r.useContext)(A.g)),[m,p]=(0,r.useState)((0,r.useContext)(J.OR)),[g,f]=(0,r.useState)(null),[b,x]=(0,r.useState)(null),[y,j]=(0,r.useState)(null);(0,r.useEffect)(()=>((async function(){let e=d.userItems,n=await (0,s.Xp)();n&&n.success&&(e.analyses=n.analyses);let l=await (0,s.tD)(a);l&&l.success&&(e.toolboxes=l.toolboxes);let r=(0,R.Z)("ws","ws"),i=await (0,E.i)(r);f(i);let o=await (0,E.i)(r.replace("/ws","/step_rerun"));j(o);let c=await (0,E.i)(r.replace("/ws","/edit_tool_run"),e=>console.log(e));x(c),u({...d,userItems:e,socketManagers:{mainManager:i,reRunManager:o,toolSocketManager:c}}),await fetch(ei,{method:"POST",body:JSON.stringify({doc_id:t,token:a})})})(),()=>{g&&g.close&&(g.close(),g.clearSocketTimeout()),y&&y.close&&(y.close(),y.clearSocketTimeout()),b&&b.close&&(b.close(),b.clearSocketTimeout())}),[]);let w=new q.QW,S=new F.ZP("http://localhost:33364",t,w,{params:{doc_id:t,token:a},protocol:"ws"}),C=(0,l.$c)({...createEditorConfig(null,w,S,a),placeholders:{default:"Type /analysis to start"},schema:V,_tiptapOptions:{extensions:[G,er]}});return window.editor=C,C.token=a,window.reactiveContext=v,C.onEditorContentChange(()=>{try{let e;let t=C.document.filter(e=>{var t,a;return null!=e&&null!==(t=e.content)&&void 0!==t&&!!t.length&&(null==e?void 0:null===(a=e.content[0])||void 0===a?void 0:a.text)});e=(null==t?void 0:t.length)&&""!==t[0].content[0].text?t[0].content[0].text:"Untitled document",document.title=e,w.getMap("document-title").set("title",document.title)}catch(e){console.log(e)}}),S.on("sync",()=>{c(!1)}),o?(0,n.jsx)(H.Z,{title:"Loading your document..."}):(0,n.jsx)(J.OR.Provider,{value:{val:m,update:p},children:(0,n.jsx)(A.g.Provider,{value:{val:v,update:h},children:(0,n.jsxs)(J.S.Provider,{value:{val:d,update:u},children:[(0,n.jsx)(DocNav,{token:a,currentDocId:t}),(0,n.jsxs)("div",{className:"content",children:[(0,n.jsx)("div",{className:"editor-container",children:(0,n.jsxs)(l.L6,{editor:C,theme:"light",formattingToolbar:!1,slashMenu:!1,children:[(0,n.jsx)(l.V5,{editor:C,formattingToolbar:CustomFormattingToolbar}),(0,n.jsx)(l.mu,{editor:C,triggerCharacter:"/",getItems:async e=>(0,i.yD)(getCustomSlashMenuItems(C),e)})]})}),(0,n.jsx)(DocSidebars,{})]})]})})})}var eo=Editor},79204:function(e,t){t.Z=(e,t)=>{if("http"!==e&&"ws"!==e)throw Error("Protocol not supported");return""!==t?"ws"===e?"".concat("http://localhost:33364".replace("http","ws"),"/").concat(t):"".concat("http://localhost:33364","/").concat(t):"".concat("http://localhost:33364")}}}]);